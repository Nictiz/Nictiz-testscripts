<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="playground-validation"/>
   <url value="http://nictiz.nl/fhir/TestScript/playground-validation"/>
   <version value="stu3-3.0-patchlevel 2025.31"/>\
   <name value="NAME - TestScript name should not be shown in the UI"/>
   <title value="TITLE - TestScript title should be shown in the UI"/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="DESCRIPTION - TestScript description should be shown in the UI. Can be markdown in the future but can voorlopig be rendered as string. Can be very long so Jim has designed a cutoff. Rendering newlines would be great: &#xA;&#xA;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse viverra finibus nibh vitae bibendum. Pellentesque commodo urna sit amet posuere maximus. Vivamus nulla massa, congue sit amet malesuada ut, sagittis in nulla. Quisque faucibus augue sed lectus posuere porta. Pellentesque sit amet sem scelerisque nibh vulputate pretium. Aenean porta scelerisque malesuada. Nulla gravida vehicula massa at viverra. Suspendisse quis neque augue. Quisque sit amet quam orci. Morbi hendrerit dictum est lobortis posuere. Nulla eu odio libero. Mauris quis justo cursus, aliquet urna quis, iaculis orci. Praesent dignissim dui non viverra feugiat. Morbi sit amet dui sollicitudin, congue dolor id, volutpat elit. Aenean quis urna iaculis, iaculis odio id, posuere felis. Aenean ultricies mattis faucibus. Aenean faucibus, nisi sed facilisis sagittis, metus augue pharetra enim, in pharetra leo enim at mi. Suspendisse vel ante vel eros vulputate vehicula ut in augue. Sed ac massa eget tortor commodo venenatis quis in leo. Morbi tincidunt metus eget posuere molestie. Phasellus justo tortor, lacinia eu augue ac, rutrum aliquam ipsum. Donec bibendum sem nec ullamcorper egestas  ."/>
   <origin>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="false"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="true"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <profile id="Bundle-profile"
            value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
   <profile id="BodyWeight-profile" value="http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight"/>
   <profile id="BodyHeight-profile" value="http://nictiz.nl/fhir/StructureDefinition/zib-BodyHeight"/>
   <variable>
      <name value="patient-token-id"/>
      <defaultValue value="Bearer 7ce7c666-6f96-40a7-a8fa-922056cb18b4"/>
      <description value="OAuth Token for current patient"/>
   </variable>
   <test>
      <name value="Scenario 1.14.2.2.2 - BodyWeight"/>
      <description value="Serve Observation resource(s) for zib BodyWeight"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Test XIS server to serve Observation resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?code=http://loinc.org|29463-7"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <stopTestOnFail value="false"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <stopTestOnFail value="false"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Observations conform to the zib BodyWeight profile."/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Observation))"/>
            <stopTestOnFail value="false"/>
            <validateProfileId value="BodyWeight-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Observations conform to the zib BodyHeight profile."/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Observation))"/>
            <stopTestOnFail value="false"/>
            <validateProfileId value="BodyHeight-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>
