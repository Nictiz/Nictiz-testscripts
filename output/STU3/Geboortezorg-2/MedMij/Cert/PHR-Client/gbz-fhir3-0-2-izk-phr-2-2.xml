<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="gbz-fhir3-0-2-ikz-phr-2-2"/>
   <url value="http://nictiz.nl/fhir/TestScript/gbz-fhir3-0-2-ikz-phr-2-2"/>
   <version value="stu3-3.0-patchlevel 2025.31"/>
   <name value="Nictiz Geboortezorg - Client - Scenario 2.2 - Retrieve Integrale Zwangerschapskaart resources of current pregnancy of Linda Hollanders"/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="Scenario 2.2: Retrieve Integrale Zwangerschapskaart resources of current pregnancy of Linda Hollanders"/>
   <origin>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="true"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="false"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <fixture id="episodeofcare-fixture">
      <autocreate value="false"/>
      <autodelete value="false"/>
      <resource>
         <reference value="../_reference/Kraam-Casus2/medmij-gbz-bc-MaternalRecord-ef612ccb-86ea-4bb9-80e8-f68dbd83b290.xml"/>
      </resource>
   </fixture>
   <variable>
      <name value="episode-id"/>
      <expression value="EpisodeOfCare.id"/>
      <sourceId value="episodeofcare-fixture"/>
   </variable>
   <variable>
      <name value="T"/>
      <defaultValue value="${CURRENTDATE}"/>
   </variable>
   <test id="1-RetrieveWoman">
      <name value="1-RetrieveWoman"/>
      <description value="Query Patient resource for HCIM Patient"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Patient"/>
            <description value="Test PHR client to retrieve Patient resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 Patient resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Patient)).count() &gt;= 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="2-RetrievePayer">
      <name value="2-RetrievePayer"/>
      <description value="Query Coverage resource for HCIM Payer"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Coverage"/>
            <description value="Test PHR client to retrieve Coverage resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 Coverage resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Coverage)).count() &gt;= 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="3-RetrieveFamilyMemberHistory">
      <name value="3-RetrieveFamilyMemberHistory"/>
      <description value="Query FamilyMemberHistory resource for FamilyMemberHistory"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="FamilyMemberHistory"/>
            <description value="Test PHR client to retrieve FamilyMemberHistory resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 FamilyMemberHistory resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(FamilyMemberHistory)).count() &gt;= 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="4-RetrieveDeviceUseStatement">
      <name value="4-RetrieveDeviceUseStatement"/>
      <description value="Query DeviceUseStatement resource for HCIM BladderFunction-UrineCatheter"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="DeviceUseStatement"/>
            <description value="Test PHR client to retrieve DeviceUseStatement resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?_include=DeviceUseStatement:device"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 DeviceUseStatement resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(DeviceUseStatement)).count() &gt;= 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="5-RetrieveMaternalRecord">
      <name value="5-RetrieveMaternalRecord"/>
      <description value="Test Client query operation for MaternalRecord (EpisodeOfCare) including managing organization (Organization) and care manager (Practitioner)"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="EpisodeOfCare"/>
            <description value="Test PHR client to retrieve EpisodeOfCare resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?type=http://snomed.info/sct|364320009&amp;status=active&amp;_include=EpisodeOfCare:organization&amp;_include=EpisodeOfCare:care-manager"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 EpisodeOfCare resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(EpisodeOfCare)).count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 Organization resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Organization)).count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="6-RetrieveConditions">
      <name value="6-RetrieveConditions"/>
      <description value="Test Client query operation for Conditions (including Pregnancy)"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Condition"/>
            <description value="Test PHR client to retrieve Condition resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 2 Condition resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Condition)).count() = 2"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Zwangerschap -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Condition resource(s) with code http://snomed.info/sct | 118185001. (Zwangerschap)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Condition)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '118185001').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Liggingsafwijking van foetus (bevinding)  -->
      <!--      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Geen mantelzorger)"></nts:with-parameter>
         <nts:with-parameter name="resource" value="Condition"></nts:with-parameter>
         <nts:with-parameter name="count" value="1"></nts:with-parameter>
         <nts:with-parameter name="code" value="15028002"></nts:with-parameter>
         <nts:with-parameter name="system" value="http://snomed.info/sct"></nts:with-parameter>
      </nts:include>-->
      <!-- Heeft schulden -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Condition resource(s) with code http://snomed.info/sct | 160933000. (heeft schulden)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Condition)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '160933000').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="7-RetrieveEncounters">
      <name value="7-RetrieveEncounters"/>
      <description value="Test Client query operation for Encounters"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Encounter"/>
            <description value="Test PHR client to retrieve Encounter resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?episodeofcare=EpisodeOfCare/${episode-id}&amp;_include=Encounter:practitioner"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 Encounter resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Encounter)).count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 1 Practitioner resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Practitioner)).count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Partusassistentie -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Encounter resource(s) that contains type.coding.code = 236973005. (ContactSoort)"/>
            <direction value="response"/>
            <expression value="Bundle.entry.select(resource as Encounter).where(type.coding.code.where($this='236973005').exists()).count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="8a-RetrieveObservations">
      <name value="8a-RetrieveObservations"/>
      <description value="Test Client query operation for Observations"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Test PHR client to retrieve Observation resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- zorg voor kind -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 129879003. (ability to take care of child)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '129879003').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- ligging kind (bij geboorte) -->
      <!--      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(ligging kind bij geboorte)"></nts:with-parameter>
         <nts:with-parameter name="resource" value="Observation"></nts:with-parameter>
         <nts:with-parameter name="count" value="1"></nts:with-parameter>
         <nts:with-parameter name="code" value="271692001"></nts:with-parameter>
         <nts:with-parameter name="system" value="http://snomed.info/sct"></nts:with-parameter>
      </nts:include>-->
      <!-- geboorteplaats -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 366344009. (ligging kind bij geboorte)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '366344009').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- type partus -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364336006. (type partus)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364336006').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Huilgedrag -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 28263002. (Huilgedrag)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '28263002').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Bevindingen huid -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364528001. (Bevindingen huid)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364528001').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Navelstreng -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364595007. (Navelstreng)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364595007').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Slaapgedrag -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 404950004. (Slaapgedrag)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '404950004').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Datum hielprik -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 77262006. (Datum hielprik)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '77262006').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- tijdstip breken vliezen -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 289251005. (tijdstip breken vliezen)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '289251005').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Wijze begin baring -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 160611000146102. (Wijze begin baring)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '160611000146102').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- vruchtwater -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 366334007. (vruchtwater)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '366334007').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- tijdstip begin actieve ontsluiting -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 160621000146107. (tijdstip begin actieve ontsluiting)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '160621000146107').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- geboorte van placenta -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 236994008. (geboorte van placenta)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '236994008').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- compleetheid placenta -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364343000. (compleetheid placenta)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364343000').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- aantal bloedvaten -->
      <!--      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(aantal bloedvaten)"></nts:with-parameter>
         <nts:with-parameter name="resource" value="Observation"></nts:with-parameter>
         <nts:with-parameter name="count" value="1"></nts:with-parameter>
         <nts:with-parameter name="code" value="249191003"></nts:with-parameter>
         <nts:with-parameter name="system" value="http://snomed.info/sct"></nts:with-parameter>
      </nts:include>-->
      <!-- tijd geboorte placenta -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 136311000146100. (tijd geboorte placenta)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '136311000146100').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- beoordeling familiesituatie -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 423340009. (family situation assessment)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '423340009').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- gewenste plaats bevalling -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 142961000146102. (preferred location of delivery)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '142961000146102').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- gewenste wijze voeden -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 169740003. (preferred feeding method)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '169740003').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- pregnancy duration -->
      <!--      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(pregnancy duration)"></nts:with-parameter>
         <nts:with-parameter name="resource" value="Observation"></nts:with-parameter>
         <nts:with-parameter name="count" value="1"></nts:with-parameter>
         <nts:with-parameter name="code" value="57036006"></nts:with-parameter>
         <nts:with-parameter name="system" value="http://snomed.info/sct"></nts:with-parameter>
      </nts:include>-->
      <!-- Vitamine K toegediend -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 698350008. (Vitamine K toegediend)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '698350008').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Apgar Score 10-minuten -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://loinc.org | 9271-8. (Apgar Score 10-minuten)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '9271-8').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Apgar Score 5-minuten -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://loinc.org | 9274-2. (Apgar Score 5-minuten)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '9274-2').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Apgar Score 1-minuut -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://loinc.org | 9272-6. (Apgar Score 1-minuut)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '9272-6').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Lichaamstemperatuur -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 2 Observation resource(s) with code http://loinc.org | 8310-5. (Lichaamstemperatuur)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '8310-5').count()=2).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Lichaamsgewicht -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 3 Observation resource(s) with code http://loinc.org | 29463-7. (Lichaamsgewicht)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '29463-7').count()=3).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- bloedverlies -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364332008. (bloedverlies)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364332008').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Voedingpatroon kind -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 289145007. (Voedingpatroon kind)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '289145007').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Gezinssituatie kind -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 55801000146105. (gezinssituatie kind)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '55801000146105').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- woonsituatie -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 365508006. (living situation)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '365508006').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- participatie in maatschappij -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 314845004. (partipicity in society)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '314845004').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- gravidity -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://loinc.org | 11996-6. (gravidity)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '11996-6').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- parity -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://loinc.org | 11977-6. (parity)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '11977-6').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- alcoholgebruik -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 228273003. (alcohol use)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '228273003').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <!-- geïndiceerd aantal uur kraamzorg -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 160631000146109. (geïndiceerd aantal uur kraamzorg)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '160631000146109').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <!-- drugsgebruik -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 228366006. (drug use)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '228366006').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="8b-RetrieveObservations">
      <name value="8b-RetrieveObservations"/>
      <description value="Test Client query operation for Observations"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Test PHR client to retrieve Observation resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context:Encounter.episodeofcare=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 Observation resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Observation)).count() = 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="9-RetrieveProcedures">
      <name value="9-RetrieveProcedures"/>
      <description value="Test Client query operation for (Obstetric) Procedures"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="Procedure"/>
            <description value="Test PHR client to retrieve Procedure resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}&amp;_include=Procedure:performer&amp;_include=Procedure:based-on"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 2 Procedure resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Procedure)).count() = 2"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 Organization resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Organization)).count() = 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 ProcedureRequest resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(ProcedureRequest)).count() = 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Verrichting (Bevalling) -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Procedure resource(s) with code http://snomed.info/sct | 236973005. (Bevalling)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Procedure)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '236973005').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Verrichting (Geboorte) -->
      <action>
         <assert>
            <description value="Confirm that the returned searchset Bundle contains 1 Procedure resource(s) with code http://snomed.info/sct | 3950001. (Geboorte)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Procedure)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '3950001').count()=1).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="10-RetrieveCareTeam">
      <name value="10-RetrieveCareTeam"/>
      <description value="Test Client query operation for CareTeam"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="search"/>
            </type>
            <resource value="CareTeam"/>
            <description value="Test PHR client to retrieve CareTeam resources."/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that HTTP header Authorization contains the patient token Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <direction value="request"/>
            <headerField value="Authorization"/>
            <stopTestOnFail value="false"/>
            <value value="Bearer d6ffbe31-c361-435d-a6b5-2c0b3d0cdcb1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="patient="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
            <direction value="request"/>
            <operator value="notContains"/>
            <requestURL value="subject="/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Make sure that the server of the test simulator gives a success response."/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the server of the test simulator returns a Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the response Bundle contains 0 CareTeam resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(CareTeam)).count() = 0"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>
