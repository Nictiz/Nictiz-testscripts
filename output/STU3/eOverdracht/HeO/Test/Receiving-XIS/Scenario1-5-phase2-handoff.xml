<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="Receiving-XIS-scenario1.5-handoff"/>
   <meta>
      <profile value="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript"/>
   </meta>
   <url value="http://nictiz.nl/fhir/TestScript/Receiving-XIS-scenario1.5-handoff"/>
   <version value="stu3-4.0-patchlevel 2025-02"/>
   <name value="Receiving-XIS-scenario1.5-handoff"/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="Scenario 1.5, test 2/2 for eOverdracht receiving systems. This test focuses on the handoff phase ('overdrachtfase'). In a normal scenario, the test for the negotiation phase ('aanmeldfase') has been completed before running this test, although it may be performed in isolation."/>
   <origin>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="true"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="false"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <fixture id="initial-task-fixture">
      <autocreate value="false"/>
      <autodelete value="false"/>
      <resource>
         <reference value="../_reference/resources/resources-specific/eOverdracht-Task-eov-test-1_5-IN-PROGRESS2.xml"/>
      </resource>
   </fixture>
   <fixture id="completed-task-fixture">
      <autocreate value="false"/>
      <autodelete value="false"/>
      <resource>
         <reference value="../_reference/resources/resources-specific/eOverdracht-Task-eov-test-1_5-COMPLETED.xml"/>
      </resource>
   </fixture>
   <setup/>
   <test>
      <name value="Read Task with nursing handoff"/>
      <description value="The receiving XIS should perform a read on the Task after receiving a notification that the Task has been updated."/>
   </test>
   <test>
      <name value="Read nursing handoff"/>
      <description value="After reading the Task, the receiving XIS should detect that a reference to the nursing handoff Composition has been added and subsequently perform a read to retrieve this Composition."/>
   </test>
   <test>
      <name value="Set Task to 'completed'"/>
      <description value="The receiving XIS should set the status of the Task to 'completed'. This should be an update operation where the original Task is sent, with only the status element changed."/>
      <action>
         <assert>
            <description value="Confirm that the Task resource contains 1 Composition reference for the nursing handoff."/>
            <direction value="request"/>
            <expression value="Task.input.where(type.coding.system = 'http://snomed.info/sct' and type.coding.code = '11171000146100').exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>
