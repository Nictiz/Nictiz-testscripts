<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="elz-serving-xis-scenario-2-minimal-CheckContent-xml"/>
   <url value="http://nictiz.nl/fhir/TestScript/elz-serving-xis-scenario-2-minimal-CheckContent-xml"/>
   <version value="R4-patchlevel 2025.31"/>
   <name value="ELZ - Serving XIS - Scenario 2 - Serving ELZ resources of XXX-Andrioli - target CheckContent - XML Format"/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="Scenario 2 - Serving ELZ resources of XXX-Andrioli"/>
   <origin>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="false"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <extension url="http://fhir.interoplab.eu/fhir/StructureDefinition/Interoplab-CL-ext-SUT">
         <valueBoolean value="true"/>
      </extension>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <variable>
      <name value="patient-token-id"/>
      <defaultValue value="Bearer 24a9d82d-e4ca-4680-8885-4ff3f00a7f7c"/>
      <description value="OAuth Token for current patient"/>
   </variable>
   <variable>
      <name value="composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id"/>
      <description value="Resource.id for Composition 1"/>
      <expression value="Composition.id"/>
      <sourceId value="fixture-03-serve-Composition"/>
   </variable>
   <variable>
      <name value="taskid-minimum"/>
      <description value="The resource id of the Task"/>
   </variable>
   <variable>
      <name value="servicerequestid"/>
      <description value="The resource id of the Servicerequest"/>
      <expression value="Task.focus.reference.replaceMatches('^.*ServiceRequest/','')"/>
      <sourceId value="taskfromserver"/>
   </variable>
   <variable>
      <name value="compositionid"/>
      <description value="The resource id of the Composition"/>
      <expression value="ServiceRequest.supportingInfo.first().reference.replaceMatches('^.*Composition/','')"/>
      <sourceId value="servicerequestfromserver"/>
   </variable>
   <variable>
      <name value="task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id"/>
      <description value="Resource.id for Task 1"/>
      <expression value="Task.id"/>
      <sourceId value="fixture-01-serve-Task"/>
   </variable>
   <variable>
      <name value="servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id"/>
      <description value="Resource.id for ServiceRequest 1"/>
      <expression value="ServiceRequest.id"/>
      <sourceId value="fixture-02-serve-ServiceRequest"/>
   </variable>
   <test id="01-serve-Task">
      <name value="Scenario 2.1 - Task"/>
      <description value="Serve Task resource"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="read"/>
            </type>
            <resource value="Task"/>
            <description value="Test server to serve Task resource."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="/${taskid-minimum}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <responseId value="taskfromserver"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Task.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Task.descendants().where($this.is(coding)).where(system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2')).exists().not()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Task.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Task.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Task.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 2.1 - Task - Check Task"/>
      <description value="Check if the previous operation results in a FHIR Task that contains the values that are expected following Nictiz' materials (fixture .id: task-hg-VerwijzingHuisartsParamedicusMinimaalbericht)"/>
      <action>
         <assert>
            <description value="Response contains exactly 1 Task"/>
            <direction value="response"/>
            <expression value="Task.count() = 1"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Task resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Task.id.exists()"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralTask'"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralTask').exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').identifier.where(system and value).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-3"/>
            <description value="Contains .status 'in-progress'"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').status = 'in-progress'"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-4"/>
            <description value="Contains .intent 'order'"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').intent = 'order'"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '3457005' and .display"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '3457005' and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-6"/>
            <description value="Contains .focus with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').focus.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-7"/>
            <description value="Contains .for with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').for.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-8"/>
            <description value="Contains .authoredOn"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').authoredOn.exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-9"/>
            <description value="Contains .requester with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').requester.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-10"/>
            <description value="Contains .owner with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Task.where(id = '${task-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').owner.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="02-serve-ServiceRequest">
      <name value="Scenario 2.2 - ServiceRequest"/>
      <description value="Serve ServiceRequest resource"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="read"/>
            </type>
            <resource value="ServiceRequest"/>
            <description value="Test server to serve ServiceRequest resource."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="/${servicerequestid}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <responseId value="servicerequestfromserver"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="ServiceRequest.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="ServiceRequest.descendants().where($this.is(coding)).where(system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2')).exists().not()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="ServiceRequest.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="ServiceRequest.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="ServiceRequest.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 2.2 - ServiceRequest - Check ServiceRequest"/>
      <description value="Check if the previous operation results in a FHIR ServiceRequest that contains the values that are expected following Nictiz' materials (fixture .id: servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht)"/>
      <action>
         <assert>
            <description value="Response contains exactly 1 ServiceRequest"/>
            <direction value="response"/>
            <expression value="ServiceRequest.count() = 1"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="ServiceRequest resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="ServiceRequest.id.exists()"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralServiceRequest'"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralServiceRequest').exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').identifier.where(system and value).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-3"/>
            <description value="Contains .status 'completed'"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').status = 'completed'"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-4"/>
            <description value="Contains .intent 'order'"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').intent = 'order'"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-5"/>
            <description value="Contains .category with .coding with .system 'urn:oid:2.16.840.1.113883.2.4.4.30.69' and .code '1' and .display"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').category.where(coding.where(system = 'urn:oid:2.16.840.1.113883.2.4.4.30.69' and code = '1' and display)).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').subject.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-7"/>
            <description value="Contains .authoredOn"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').authoredOn.exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-8"/>
            <description value="Contains .requester with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').requester.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-9"/>
            <description value="Contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').performer.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-10"/>
            <description value="Contains .supportingInfo with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="ServiceRequest.where(id = '${servicerequest-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').supportingInfo.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="03-serve-Composition">
      <name value="Scenario 2.3 - Composition"/>
      <description value="Serve Composition resource with all the references by using the Document operation"/>
      <action>
         <operation>
            <type>
               <system value="http://hl7.org/fhir/restful-interaction"/>
               <code value="read"/>
            </type>
            <resource value="Composition"/>
            <description value="Test server to serve Composition resource."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="/${compositionid}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <stopTestOnFail value="true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Composition.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Composition.descendants().where($this.is(coding)).where(system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2')).exists().not()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Composition.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Composition.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Composition.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 2.3 - Composition - Check Composition"/>
      <description value="Check if the previous operation results in a FHIR Composition that contains the values that are expected following Nictiz' materials (fixture .id: composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response contains exactly 1 Composition"/>
            <direction value="response"/>
            <expression value="Composition.count() = 1"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Composition resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Composition.id.exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralComposition'"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/hg-ReferralComposition').exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').identifier.where(system and value).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').status = 'final'"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .type with .coding with .system 'http://loinc.org' and .code '57133-1' and .display"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').type.coding.where(system = 'http://loinc.org' and code = '57133-1' and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').subject.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .date"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').date.exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .author with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').author.where((reference or identifier) and display).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8"/>
            <description value="Contains .title with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').title.hasValue()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9"/>
            <description value="Contains .section with .title with a value, and .code with .coding with .system 'http://snomed.info/sct' and .code '406550009' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(title.hasValue() and code.coding.where(system = 'http://snomed.info/sct' and code = '406550009' and display).exists()).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-1"/>
            <description value="Contains .section.title with a value. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(title.hasValue()).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-2"/>
            <description value="Contains .section.code with .coding with .system 'http://snomed.info/sct' and .code '406550009' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(code.coding.where(system = 'http://snomed.info/sct' and code = '406550009' and display).exists()).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-3-1"/>
            <description value="Contains .section.section.extension with url 'http://nictiz.nl/fhir/StructureDefinition/ext-TextValue' with .valueString with a value. This assert checks only one child. Assert 1-9-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <!--FHIRPath expressions with .ofType(...) are poorly supported at the moment, so it was rewritten. Original expression: 'Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(section.where(extension('http://nictiz.nl/fhir/StructureDefinition/ext-TextValue').value.ofType(string).hasValue())).exists()'-->
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(section.where(extension('http://nictiz.nl/fhir/StructureDefinition/ext-TextValue').value.where($this is string).hasValue())).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-4-1"/>
            <description value="Contains .section.section.extension with url 'http://nictiz.nl/fhir/StructureDefinition/ext-TextValue' with .valueString with a value. This assert checks only one child. Assert 1-9-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <!--FHIRPath expressions with .ofType(...) are poorly supported at the moment, so it was rewritten. Original expression: 'Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(section.where(extension('http://nictiz.nl/fhir/StructureDefinition/ext-TextValue').value.ofType(string).hasValue())).exists()'-->
            <expression value="Composition.where(id = '${composition-hg-VerwijzingHuisartsParamedicusMinimaalbericht-id}').section.where(section.where(extension('http://nictiz.nl/fhir/StructureDefinition/ext-TextValue').value.where($this is string).hasValue())).exists()"/>
            <stopTestOnFail value="false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>
