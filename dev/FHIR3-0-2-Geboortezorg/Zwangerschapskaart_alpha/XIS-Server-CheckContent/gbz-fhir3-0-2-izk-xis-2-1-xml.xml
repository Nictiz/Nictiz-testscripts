<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
   <id value="gbz-fhir3-0-2-ikz-xis-2-1-CheckContent-xml"/>
   <meta>
      <profile value="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript"/>
   </meta>
   <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-rule">
      <extension url="ruleId">
         <valueId value="assert-response-queryParamsInSelfLink"/>
      </extension>
      <extension url="path">
         <valueString value="../_reference/rules/assert_response_queryParamsInSelfLink.groovy"/>
      </extension>
   </extension>
   <url value="http://nictiz.nl/fhir/TestScript/gbz-fhir3-0-2-ikz-xis-2-1-CheckContent-xml"/>
   <version value="stu3-3.0-patchlevel 2024-03"/>
   <name value="Nictiz Geboortezorg - Server - Scenario 2.1 - Serve Integrale Zwangerschapskaart resources of current pregnancy of Kim Zhanganak - target CheckContent - XML Format"/>
   <status value="active"/>
   <publisher value="Nictiz"/>
   <contact>
      <name value="Nictiz"/>
      <telecom>
         <system value="email"/>
         <value value="kwalificatie@nictiz.nl"/>
         <use value="work"/>
      </telecom>
   </contact>
   <description value="Scenario 2.1: Serve Integrale Zwangerschapskaart resources of current pregnancy of Kim Zhanganak"/>
   <origin>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-origin-types"/>
         <code value="FHIR-Client"/>
      </profile>
   </origin>
   <destination>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
      </profile>
   </destination>
   <profile id="Bundle-profile">
      <reference value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
   </profile>
   <variable>
      <name value="patient-token-id"/>
      <defaultValue value="Bearer 56b4b2b6-f9a3-43df-9e14-7e853c784138"/>
      <description value="OAuth Token for current patient"/>
   </variable>
   <variable>
      <name value="episode-id"/>
      <description value="This variable needs to be filled with the following params. The name (the variable name), status (of the episode), sourceId (id of the resource) and as resource EpisodeOfCare should be filled in"/>
      <expression value="Bundle.entry.where(resource.is(EpisodeOfCare)).resource.where(type.coding.code='364320009' and status='active').id"/>
      <sourceId value="fixture-5-ServeMaternalRecord"/>
   </variable>
   <variable>
      <name value="T"/>
      <defaultValue value="${CURRENTDATE}"/>
   </variable>
   <variable>
      <name value="X-Correlation-ID"/>
      <defaultValue value="${UUID}"/>
      <description value="X-Correlation-ID, by default a UUID following the MedMij Afsprakenstelsel. Does not have to be edited, see https://nictiz.atlassian.net/browse/MM-5132 for more information"/>
   </variable>
   <variable>
      <name value="KIMXXX-Zhanganak-id"/>
      <description value="Resource.id for Patient 1"/>
      <expression value="Bundle.entry.resource.ofType(Patient).id"/>
      <sourceId value="fixture-1-ServeWoman"/>
   </variable>
   <variable>
      <name value="1-12-839-1-113883-2-4-6-108004321-id"/>
      <description value="Resource.id for Coverage 1"/>
      <expression value="Bundle.entry.resource.ofType(Coverage).id"/>
      <sourceId value="fixture-2-ServePayer"/>
   </variable>
   <variable>
      <name value="0d479b8b-2064-12ec-1751-020000000000-id"/>
      <description value="Resource.id for EpisodeOfCare 1"/>
      <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).id"/>
      <sourceId value="fixture-5-ServeMaternalRecord"/>
   </variable>
   <variable>
      <name value="0d47afc5-1963-11ec-1751-020000000000-id"/>
      <description value="Resource.id for Condition 1"/>
      <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '118185001'))).id"/>
      <sourceId value="fixture-6-ServeConditions"/>
   </variable>
   <variable>
      <name value="a4918b3f-2221-11ec-8161-020000000000-id"/>
      <description value="Resource.id for Condition 2"/>
      <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '708014007'))).id"/>
      <sourceId value="fixture-6-ServeConditions"/>
   </variable>
   <variable>
      <name value="a4908b3f-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Condition 3"/>
      <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '199934009'))).id"/>
      <sourceId value="fixture-6-ServeConditions"/>
   </variable>
   <variable>
      <name value="2-19-841-1-113883-2-4-5-107004321-id"/>
      <description value="Resource.id for Encounter 1"/>
      <expression value="Bundle.entry.resource.ofType(Encounter).where(type.where(coding.code = '236973005')).id"/>
      <sourceId value="fixture-7-ServeEncounters"/>
   </variable>
   <variable>
      <name value="0d47afdc-2982-11ec-1751-020000000000-id"/>
      <description value="Resource.id for Encounter 2"/>
      <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference != Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).id"/>
      <sourceId value="fixture-7-ServeEncounters"/>
   </variable>
   <variable>
      <name value="1s47afdc-2982-11ec-1751-020000000000-id"/>
      <description value="Resource.id for Encounter 3"/>
      <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference = Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).id"/>
      <sourceId value="fixture-7-ServeEncounters"/>
   </variable>
   <variable>
      <name value="a4907bc6-2392-11ec-8669-030000000000-id"/>
      <description value="Resource.id for Observation 1"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '57036006'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="0d47afc6-2063-11ec-1749-020000000000-id"/>
      <description value="Resource.id for Observation 2"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11977-6'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="0d47gec7-2063-11ec-1751-020000000000-id"/>
      <description value="Resource.id for Observation 3"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11996-6'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="2-17-831-1-113883-2-4-6-108004321-id"/>
      <description value="Resource.id for Observation 4"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365508006'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="193477a5-3fde-11ec-3274-020000000000-id"/>
      <description value="Resource.id for Observation 5"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365470003'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="1c6e08c1-9edr-11ec-1563-020000000000-id"/>
      <description value="Resource.id for Observation 6"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '314845004'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7816n34-2191-19ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 7"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '129879003'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="2-17-831-1-113773-2-4-5-107004321-id"/>
      <description value="Resource.id for Observation 8"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '142961000146102'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="2-17-831-1-113883-2-4-5-107004321-id"/>
      <description value="Resource.id for Observation 9"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '169740003'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d238d44b-2062-11ec-2089-020000000000-id"/>
      <description value="Resource.id for Observation 10"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '289251005'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d238d44b-2062-11ec-2046-020000000000-id"/>
      <description value="Resource.id for Observation 11"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '366334007'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d735d974-2062-11ed-2093-020000000000-id"/>
      <description value="Resource.id for Observation 12"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249163006'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d715d984-2062-11ed-2093-020000000000-id"/>
      <description value="Resource.id for Observation 13"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364336006'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="166579o5-8fde-12ec-3274-020000000000-id"/>
      <description value="Resource.id for Observation 14"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364332008'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d715d984-2062-68es-2093-020000000000-id"/>
      <description value="Resource.id for Observation 15"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '271692001'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a239d44b-2062-11ec-2089-020000000000-id"/>
      <description value="Resource.id for Observation 16"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364343000'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a239d24h-2062-11ec-2089-020000000000-id"/>
      <description value="Resource.id for Observation 17"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249191003'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d238d34c-2062-11ec-2089-020000000000-id"/>
      <description value="Resource.id for Observation 18"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '136311000146100'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a4907b9r-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 19"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9272-6'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a4912b60-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 20"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9274-2'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a4907b81-2290-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 21"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9271-8'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a4506b72-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 22"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8339-4'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d735d999-2062-11ec-1087-020000000000-id"/>
      <description value="Resource.id for Observation 23"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3400').id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="d715d939-2012-11ec-1087-020000000000-id"/>
      <description value="Resource.id for Observation 24"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3630').id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="166578a5-8fde-12ec-3274-020000000000-id"/>
      <description value="Resource.id for Observation 25"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.7').id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="193578a5-8fde-12ec-3274-020000000000-id"/>
      <description value="Resource.id for Observation 26"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.8').id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a2406b64-2391-14ec-4667-020000000000-id"/>
      <description value="Resource.id for Observation 27"/>
      <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &lt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="a2406b64-2391-14ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 28"/>
      <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &gt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="v6516b72-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 29"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '404950004'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="g3506b72-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 30"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '28263002'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="8224fe9f-43b4-4917-aac5-5d69269560b4-id"/>
      <description value="Resource.id for Observation 31"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364595007'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7806b72-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 32"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364528001'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7806b34-2391-11rz-8263-020000000000-id"/>
      <description value="Resource.id for Observation 33"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '1263932002'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7106b24-2291-11ex-8663-020000000000-id"/>
      <description value="Resource.id for Observation 34"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '118791000146100'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="193478a5-8fde-12ec-3274-020000000000-id"/>
      <description value="Resource.id for Observation 35"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '698350008'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7806b34-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 36"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '252957005'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="b7859b34-2291-11ec-8669-020000000000-id"/>
      <description value="Resource.id for Observation 37"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '77262006'))).id"/>
      <sourceId value="fixture-8a-ServeObservations"/>
   </variable>
   <variable>
      <name value="0d47afe5-2063-11ec-1752-020000000000-id"/>
      <description value="Resource.id for Observation 1"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '228273003'))).id"/>
      <sourceId value="fixture-8b-ServeObservations"/>
   </variable>
   <variable>
      <name value="0d47afe9-2063-11ec-1752-020000000000-id"/>
      <description value="Resource.id for Observation 2"/>
      <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365980008'))).id"/>
      <sourceId value="fixture-8b-ServeObservations"/>
   </variable>
   <variable>
      <name value="d135d241-2062-11ec-2089-020000000000-id"/>
      <description value="Resource.id for Procedure 1"/>
      <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '236973005'))).id"/>
      <sourceId value="fixture-9-ServeProcedures"/>
   </variable>
   <variable>
      <name value="6b971017-a6d9-11ek-1598-020000000000-id"/>
      <description value="Resource.id for Procedure 2"/>
      <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '3950001'))).id"/>
      <sourceId value="fixture-9-ServeProcedures"/>
   </variable>
   <variable>
      <name value="66aa1132-2064-11ec-5265-020000000000-id"/>
      <description value="Resource.id for Procedure 3"/>
      <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '29701000146104'))).id"/>
      <sourceId value="fixture-9-ServeProcedures"/>
   </variable>
   <test id="1-ServeWoman">
      <name value="1-ServeWoman"/>
      <description value="Query Patient resource for HCIM Patient"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Patient"/>
            <description value="Test XIS server to serve Patient resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-1-ServeWoman"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 1 Patient resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Patient)).count() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="1-ServeWoman - Check Patient"/>
      <description value="Check if the previous operation results in a FHIR Patient that contains the values that are expected following Nictiz' materials (fixture .id: KIMXXX-Zhanganak)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Patient"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Patient resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-patient' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-Woman'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-patient') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-Woman')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .name with .extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-assembly-order' with .valueCode 'NL1' and .text with a value, and .family with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-own-name' with .valueString with a value and .extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-partner-name' with .valueString with a value, and .given with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'BR', and .given with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'IN'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(extension('http://hl7.org/fhir/StructureDefinition/humanname-assembly-order').value.ofType(code) = 'NL1' and text.hasValue() and family.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/humanname-own-name').value.ofType(string).hasValue() and extension('http://hl7.org/fhir/StructureDefinition/humanname-partner-name').value.ofType(string).hasValue()) and given.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'BR') and given.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'IN')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-1"/>
            <description value="Contains .name.extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-assembly-order' with .valueCode 'NL1'. This assert checks only one child. Assert 1-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(extension('http://hl7.org/fhir/StructureDefinition/humanname-assembly-order').value.ofType(code) = 'NL1').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-2"/>
            <description value="Contains .name.text with a value. This assert checks only one child. Assert 1-3 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(text.hasValue()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-3"/>
            <description value="Contains .name.family with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-own-name' with .valueString with a value and .extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-partner-name' with .valueString with a value. This assert checks only one child. Assert 1-3 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(family.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/humanname-own-name').value.ofType(string).hasValue() and extension('http://hl7.org/fhir/StructureDefinition/humanname-partner-name').value.ofType(string).hasValue()).exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-3-1"/>
            <description value="Contains .name.family with a value. This assert checks only one child. Assert 1-3-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(family.hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-3-2"/>
            <description value="Contains .name.family.extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-own-name' with .valueString with a value. This assert checks only one child. Assert 1-3-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(family.extension('http://hl7.org/fhir/StructureDefinition/humanname-own-name').value.ofType(string).hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-3-3"/>
            <description value="Contains .name.family.extension with url 'http://hl7.org/fhir/StructureDefinition/humanname-partner-name' with .valueString with a value. This assert checks only one child. Assert 1-3-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(family.extension('http://hl7.org/fhir/StructureDefinition/humanname-partner-name').value.ofType(string).hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-4"/>
            <description value="Contains .name.given with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'BR'. This assert checks only one child. Assert 1-3 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'BR').exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-4-1"/>
            <description value="Contains .name.given with a value. This assert checks only one child. Assert 1-3-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where($this.hasValue()).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-4-2"/>
            <description value="Contains .name.given.extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'BR'. This assert checks only one child. Assert 1-3-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where(extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'BR')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-5"/>
            <description value="Contains .name.given with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'IN'. This assert checks only one child. Assert 1-3 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'IN').exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-5-1"/>
            <description value="Contains .name.given with a value. This assert checks only one child. Assert 1-3-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where($this.hasValue()).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3-5-2"/>
            <description value="Contains .name.given.extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier' with .valueCode 'IN'. This assert checks only one child. Assert 1-3-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').name.where(given.where(extension('http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier').value.ofType(code) = 'IN')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .telecom with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-ContactInformation-TelecomType' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AddressUse' and .code 'MC' and .display and .system 'phone', and .value with a value, and .use 'home'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').telecom.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-ContactInformation-TelecomType').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AddressUse' and code = 'MC' and display) and system = 'phone' and value.hasValue() and use = 'home').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4-1"/>
            <description value="Contains .telecom.extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-ContactInformation-TelecomType' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AddressUse' and .code 'MC' and .display. This assert checks only one child. Assert 1-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').telecom.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-ContactInformation-TelecomType').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AddressUse' and code = 'MC' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4-2"/>
            <description value="Contains .telecom.system 'phone'. This assert checks only one child. Assert 1-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').telecom.where(system = 'phone').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4-3"/>
            <description value="Contains .telecom.value with a value. This assert checks only one child. Assert 1-4 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').telecom.where(value.hasValue()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4-4"/>
            <description value="Contains .telecom.use 'home'. This assert checks only one child. Assert 1-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').telecom.where(use = 'home').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .gender 'female' and with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/code-specification' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AdministrativeGender' and .code 'F' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').gender.where($this = 'female' and extension('http://nictiz.nl/fhir/StructureDefinition/code-specification').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AdministrativeGender' and code = 'F' and display)).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5-1"/>
            <description value="Contains .gender 'female'. This assert checks only one child. Assert 1-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').gender = 'female'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5-2"/>
            <description value="Contains .gender.extension with url 'http://nictiz.nl/fhir/StructureDefinition/code-specification' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AdministrativeGender' and .code 'F' and .display. This assert checks only one child. Assert 1-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').gender.extension('http://nictiz.nl/fhir/StructureDefinition/code-specification').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AdministrativeGender' and code = 'F' and display).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .birthDate"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').birthDate.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .address with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-AddressInformation-AddressType' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AddressUse' and .code 'PHYS' and .display and .use 'home', and .type 'physical', and .line with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName' with .valueString with a value and .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber' with .valueString with a value, and .city with a value, and .postalCode with a value, and .country with a value and with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/code-specification' with .valueCodeableConcept with .coding with .system 'urn:iso:std:iso:3166' and .code 'NL' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-AddressInformation-AddressType').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AddressUse' and code = 'PHYS' and display) and use = 'home' and type = 'physical' and line.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName').value.ofType(string).hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber').value.ofType(string).hasValue()) and city.hasValue() and postalCode.hasValue() and country.where($this.hasValue() and extension('http://nictiz.nl/fhir/StructureDefinition/code-specification').value.ofType(CodeableConcept).coding.where(system = 'urn:iso:std:iso:3166' and code = 'NL' and display))).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-1"/>
            <description value="Contains .address.extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-AddressInformation-AddressType' with .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/AddressUse' and .code 'PHYS' and .display. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-AddressInformation-AddressType').value.ofType(CodeableConcept).coding.where(system = 'http://hl7.org/fhir/v3/AddressUse' and code = 'PHYS' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-2"/>
            <description value="Contains .address.use 'home'. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(use = 'home').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-3"/>
            <description value="Contains .address.type 'physical'. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(type = 'physical').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-4"/>
            <description value="Contains .address.line with a value and with .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName' with .valueString with a value and .extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber' with .valueString with a value. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(line.where($this.hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName').value.ofType(string).hasValue() and extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber').value.ofType(string).hasValue()).exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-4-1"/>
            <description value="Contains .address.line with a value. This assert checks only one child. Assert 1-7-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(line.where($this.hasValue()).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-4-2"/>
            <description value="Contains .address.line.extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName' with .valueString with a value. This assert checks only one child. Assert 1-7-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(line.where(extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName').value.ofType(string).hasValue())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-4-3"/>
            <description value="Contains .address.line.extension with url 'http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber' with .valueString with a value. This assert checks only one child. Assert 1-7-4 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(line.where(extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-houseNumber').value.ofType(string).hasValue())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-5"/>
            <description value="Contains .address.city with a value. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(city.hasValue()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-6"/>
            <description value="Contains .address.postalCode with a value. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(postalCode.hasValue()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-7"/>
            <description value="Contains .address.country with a value and with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/code-specification' with .valueCodeableConcept with .coding with .system 'urn:iso:std:iso:3166' and .code 'NL' and .display. This assert checks only one child. Assert 1-7 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(country.where($this.hasValue() and extension('http://nictiz.nl/fhir/StructureDefinition/code-specification').value.ofType(CodeableConcept).coding.where(system = 'urn:iso:std:iso:3166' and code = 'NL' and display)).exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-7-1"/>
            <description value="Contains .address.country with a value. This assert checks only one child. Assert 1-7-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(country.hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7-7-2"/>
            <description value="Contains .address.country.extension with url 'http://nictiz.nl/fhir/StructureDefinition/code-specification' with .valueCodeableConcept with .coding with .system 'urn:iso:std:iso:3166' and .code 'NL' and .display. This assert checks only one child. Assert 1-7-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').address.where(country.extension('http://nictiz.nl/fhir/StructureDefinition/code-specification').value.ofType(CodeableConcept).coding.where(system = 'urn:iso:std:iso:3166' and code = 'NL' and display).exists()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8"/>
            <description value="Contains .maritalStatus with .coding with .system 'http://hl7.org/fhir/v3/MaritalStatus' and .code 'M' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').maritalStatus.coding.where(system = 'http://hl7.org/fhir/v3/MaritalStatus' and code = 'M' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9"/>
            <description value="Contains .communication with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/patient-proficiency' with .extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'ESP' and .display and .extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display and .extension with url 'http://nictiz.nl/fhir/StructureDefinition/patient-proficiency' with .extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'RWR' and .display and .extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display and .language with .coding with .system 'urn:ietf:bcp:47' and .code 'nl' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'ESP' and display) and extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display)) and extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'RWR' and display) and extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display)) and language.coding.where(system = 'urn:ietf:bcp:47' and code = 'nl' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-1"/>
            <description value="Contains .communication.extension with url 'http://nictiz.nl/fhir/StructureDefinition/patient-proficiency' with .extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'ESP' and .display and .extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'ESP' and display) and extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display)).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-1-1"/>
            <description value="Contains .communication.extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'ESP' and .display. This assert checks only one child. Assert 1-9-1 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'ESP' and display).exists())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-1-2"/>
            <description value="Contains .communication.extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display. This assert checks only one child. Assert 1-9-1 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display).exists())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-2"/>
            <description value="Contains .communication.extension with url 'http://nictiz.nl/fhir/StructureDefinition/patient-proficiency' with .extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'RWR' and .display and .extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'RWR' and display) and extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display)).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-2-1"/>
            <description value="Contains .communication.extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').extension with url 'type' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityMode' and .code 'RWR' and .display. This assert checks only one child. Assert 1-9-2 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('type').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityMode' and code = 'RWR' and display).exists())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-2-2"/>
            <description value="Contains .communication.extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').extension with url 'level' with .valueCoding with .system 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and .code 'G' and .display. This assert checks only one child. Assert 1-9-2 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(extension('http://nictiz.nl/fhir/StructureDefinition/patient-proficiency').where(extension('level').value.ofType(Coding).where(system = 'http://hl7.org/fhir/v3/LanguageAbilityProficiency' and code = 'G' and display).exists())).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-3"/>
            <description value="Contains .communication.language with .coding with .system 'urn:ietf:bcp:47' and .code 'nl' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Patient).where(id = '${KIMXXX-Zhanganak-id}').communication.where(language.coding.where(system = 'urn:ietf:bcp:47' and code = 'nl' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="2-ServePayer">
      <name value="2-ServePayer"/>
      <description value="Query Coverage resource for HCIM Payer"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Coverage"/>
            <description value="Test XIS server to serve Coverage resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-2-ServePayer"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 1 Coverage resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Coverage)).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="2-ServePayer - Check Coverage"/>
      <description value="Check if the previous operation results in a FHIR Coverage that contains the values that are expected following Nictiz' materials (fixture .id: 1-12-839-1-113883-2-4-6-108004321)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Coverage"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Coverage resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Payer'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Payer').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .subscriber with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').subscriber.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .beneficiary with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').beneficiary.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .period with .start and .end"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').period.where(start and end).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .payor with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Coverage).where(id = '${1-12-839-1-113883-2-4-6-108004321-id}').payor.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="3-ServeFamilyMemberHistory">
      <name value="3-ServeFamilyMemberHistory"/>
      <description value="Query FamilyMemberHistory resource for FamilyMemberHistory"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="FamilyMemberHistory"/>
            <description value="Test XIS server to serve FamilyMemberHistory resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-3-ServeFamilyMemberHistory"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 0 FamilyMemberHistory resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(FamilyMemberHistory)).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="4-ServeDeviceUseStatement">
      <name value="4-ServeDeviceUseStatement"/>
      <description value="Query DeviceUseStatement resource for HCIM BladderFunction-UrineCatheter"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="DeviceUseStatement"/>
            <description value="Test XIS server to serve DeviceUseStatement resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?_include=DeviceUseStatement:device"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-4-ServeDeviceUseStatement"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 0 DeviceUseStatement resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(DeviceUseStatement)).count() &gt;= 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="5-ServeMaternalRecord">
      <name value="5-ServeMaternalRecord"/>
      <description value="Test Server query operation for MaternalRecord (EpisodeOfCare) including managing organization (Organization) and care manager (Practitioner)"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="EpisodeOfCare"/>
            <description value="Test XIS server to serve EpisodeOfCare resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?type=http://snomed.info/sct|364320009&amp;status=active&amp;_include=EpisodeOfCare:organization&amp;_include=EpisodeOfCare:care-manager"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-5-ServeMaternalRecord"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 1 EpisodeOfCare resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(EpisodeOfCare)).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 1 Organization resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Organization)).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="5-ServeMaternalRecord - Check EpisodeOfCare"/>
      <description value="Check if the previous operation results in a FHIR EpisodeOfCare that contains the values that are expected following Nictiz' materials (fixture .id: 0d479b8b-2064-12ec-1751-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 EpisodeOfCare"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="EpisodeOfCare resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-episodeofcare' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalRecord'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-episodeofcare') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalRecord')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .status 'active'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').status = 'active'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .type with .coding with .system 'http://snomed.info/sct' and .code '364320009' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').type.where(coding.where(system = 'http://snomed.info/sct' and code = '364320009' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .diagnosis with .condition with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').diagnosis.where(condition.where((reference or identifier) and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .patient with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').patient.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .managingOrganization with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(EpisodeOfCare).where(id = '${0d479b8b-2064-12ec-1751-020000000000-id}').managingOrganization.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="6-ServeConditions">
      <name value="6-ServeConditions"/>
      <description value="Test Server query operation for Conditions (including Pregnancy)"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Condition"/>
            <description value="Test XIS server to serve Condition resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-6-ServeConditions"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 3 Condition resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Condition)).count() = 3"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Zwangerschap -->
      <!-- Geen mantelzorger -->
      <!-- Vierdegraads perineumruptuur durante partu -->
   </test>
   <test>
      <name value="6-ServeConditions - Check Condition 1"/>
      <description value="Check if the previous operation results in a FHIR Condition that contains the values that are expected following Nictiz' materials (fixture .id: 0d47afc5-1963-11ec-1751-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Condition with properties: contains code.coding.code = '118185001'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '118185001'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Condition resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '118185001'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .clinicalStatus 'active'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').clinicalStatus = 'active'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '118185001' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '118185001' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${0d47afc5-1963-11ec-1751-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="6-ServeConditions - Check Condition 2"/>
      <description value="Check if the previous operation results in a FHIR Condition that contains the values that are expected following Nictiz' materials (fixture .id: a4918b3f-2221-11ec-8161-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Condition with properties: contains code.coding.code = '708014007'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '708014007'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Condition resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '708014007'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Problem'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Problem').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-3"/>
            <description value="Contains .clinicalStatus 'active'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').clinicalStatus = 'active'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '708014007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '708014007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4918b3f-2221-11ec-8161-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="6-ServeConditions - Check Condition 3"/>
      <description value="Check if the previous operation results in a FHIR Condition that contains the values that are expected following Nictiz' materials (fixture .id: a4908b3f-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Condition with properties: contains code.coding.code = '199934009'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '199934009'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Condition resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(code.where(coding.where(code = '199934009'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Problem' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DisorderOfLaborAndDelivery'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Problem') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DisorderOfLaborAndDelivery')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-2"/>
            <description value="Contains .extension with url 'http://hl7.org/fhir/StructureDefinition/condition-partOf' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').extension('http://hl7.org/fhir/StructureDefinition/condition-partOf').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-4"/>
            <description value="Contains .clinicalStatus 'active'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').clinicalStatus = 'active'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-5"/>
            <description value="Contains .category with .coding with .system 'http://snomed.info/sct' and .code '362972006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').category.where(coding.where(system = 'http://snomed.info/sct' and code = '362972006' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-6"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '199934009' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '199934009' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-7"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-8"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Condition).where(id = '${a4908b3f-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="7-ServeEncounters">
      <name value="7-ServeEncounters"/>
      <description value="Test Server query operation for Encounters"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Encounter"/>
            <description value="Test XIS server to serve Encounter resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?episodeofcare=${episode-id}&amp;_include=Encounter:practitioner"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-7-ServeEncounters"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 3 Encounter resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Encounter)).count() = 3"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 2 Practitioner resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Practitioner)).count() = 2"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Partusassistentie -->
      <!-- Opname in ziekenhuis -->
   </test>
   <test>
      <name value="7-ServeEncounters - Check Encounter 1"/>
      <description value="Check if the previous operation results in a FHIR Encounter that contains the values that are expected following Nictiz' materials (fixture .id: 2-19-841-1-113883-2-4-5-107004321)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Encounter"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(type.where(coding.code = '236973005')).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Encounter resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(type.where(coding.code = '236973005')).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildBirthAssistance'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildBirthAssistance').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .status 'finished'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').status = 'finished'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .class with .system 'http://hl7.org/fhir/v3/ActCode' and .code 'SS' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').class.where(system = 'http://hl7.org/fhir/v3/ActCode' and code = 'SS' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .type with .coding with .system 'http://snomed.info/sct' and .code '236973005' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').type.where(coding.where(system = 'http://snomed.info/sct' and code = '236973005' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .episodeOfCare with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').episodeOfCare.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8"/>
            <description value="Contains .participant with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/bc-encounter-arrival' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '42857002' and .display and .extension with url 'http://nictiz.nl/fhir/StructureDefinition/bc-childbirthassistance-timecalled' with .valueDateTime and .type with .coding with .system 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and .code 'assistent' and .display, and .period with .start and .end, and .individual with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display, and with either .reference or .identifier and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(extension('http://nictiz.nl/fhir/StructureDefinition/bc-encounter-arrival').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '42857002' and display) and extension('http://nictiz.nl/fhir/StructureDefinition/bc-childbirthassistance-timecalled').value.ofType(dateTime) and type.where(coding.where(system = 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and code = 'assistent' and display)) and period.where(start and end) and individual.where(extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display) and (reference or identifier) and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-1"/>
            <description value="Contains .participant.extension with url 'http://nictiz.nl/fhir/StructureDefinition/bc-encounter-arrival' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '42857002' and .display. This assert checks only one child. Assert 1-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(extension('http://nictiz.nl/fhir/StructureDefinition/bc-encounter-arrival').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '42857002' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-2"/>
            <description value="Contains .participant.extension with url 'http://nictiz.nl/fhir/StructureDefinition/bc-childbirthassistance-timecalled' with .valueDateTime. This assert checks only one child. Assert 1-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(extension('http://nictiz.nl/fhir/StructureDefinition/bc-childbirthassistance-timecalled').value.ofType(dateTime).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-3"/>
            <description value="Contains .participant.type with .coding with .system 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and .code 'assistent' and .display. This assert checks only one child. Assert 1-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(type.where(coding.where(system = 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and code = 'assistent' and display)).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-4"/>
            <description value="Contains .participant.period with .start and .end. This assert checks only one child. Assert 1-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(period.where(start and end).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-5"/>
            <description value="Contains .participant.individual with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display, and with either .reference or .identifier and .display. This assert checks only one child. Assert 1-8 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.where(extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display) and (reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-5-1"/>
            <description value="Contains .participant.individual.extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display. This assert checks only one child. Assert 1-8-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8-5-2"/>
            <description value="Contains .participant.individual with either .reference or .identifier and .display. This assert checks only one child. Assert 1-8-5 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.where((reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9"/>
            <description value="Contains .participant with .type with .coding with .system 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and .code 'supervisor' and .display, and .period with .start and .end, and .individual with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display, and with either .reference or .identifier and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(type.where(coding.where(system = 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and code = 'supervisor' and display)) and period.where(start and end) and individual.where(extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display) and (reference or identifier) and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-1"/>
            <description value="Contains .participant.type with .coding with .system 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and .code 'supervisor' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(type.where(coding.where(system = 'http://nictiz.nl/fhir/CodeSystem/bc-ChildBirthAssistance-type' and code = 'supervisor' and display)).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-2"/>
            <description value="Contains .participant.period with .start and .end. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(period.where(start and end).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-3"/>
            <description value="Contains .participant.individual with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display, and with either .reference or .identifier and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.where(extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display) and (reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-3-1"/>
            <description value="Contains .participant.individual.extension with url 'http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference' with .valueReference with either .reference or .identifier and .display. This assert checks only one child. Assert 1-9-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.ofType(Reference).where((reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9-3-2"/>
            <description value="Contains .participant.individual with either .reference or .identifier and .display. This assert checks only one child. Assert 1-9-3 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').participant.where(individual.where((reference or identifier) and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-10"/>
            <description value="Contains .diagnosis with .condition with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').diagnosis.where(condition.where((reference or identifier) and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-11"/>
            <description value="Contains .serviceProvider with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${2-19-841-1-113883-2-4-5-107004321-id}').serviceProvider.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="7-ServeEncounters - Check Encounter 2"/>
      <description value="Check if the previous operation results in a FHIR Encounter that contains the values that are expected following Nictiz' materials (fixture .id: 0d47afdc-2982-11ec-1751-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Encounter"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference != Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Encounter resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference != Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-Encounter'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-Encounter').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-3"/>
            <description value="Contains .status 'finished'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').status = 'finished'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-4"/>
            <description value="Contains .class with .system 'http://hl7.org/fhir/v3/ActCode' and .code 'IMP' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').class.where(system = 'http://hl7.org/fhir/v3/ActCode' and code = 'IMP' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-6"/>
            <description value="Contains .episodeOfCare with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').episodeOfCare.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-7"/>
            <description value="Contains .serviceProvider with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${0d47afdc-2982-11ec-1751-020000000000-id}').serviceProvider.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="7-ServeEncounters - Check Encounter 3"/>
      <description value="Check if the previous operation results in a FHIR Encounter that contains the values that are expected following Nictiz' materials (fixture .id: 1s47afdc-2982-11ec-1751-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Encounter"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference = Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Encounter resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0].subject.reference = Bundle.entry.resource.ofType(Encounter).where(type.where(coding.where(code='236973005'))).subject.reference, Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[0], Bundle.entry.resource.ofType(Encounter).where(class.where(code='IMP'))[1]).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-Encounter'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-Encounter').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-3"/>
            <description value="Contains .status 'finished'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').status = 'finished'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-4"/>
            <description value="Contains .class with .system 'http://hl7.org/fhir/v3/ActCode' and .code 'IMP' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').class.where(system = 'http://hl7.org/fhir/v3/ActCode' and code = 'IMP' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-6"/>
            <description value="Contains .episodeOfCare with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').episodeOfCare.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-7"/>
            <description value="Contains .period with .start and .end"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').period.where(start and end).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-8"/>
            <description value="Contains .serviceProvider with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Encounter).where(id = '${1s47afdc-2982-11ec-1751-020000000000-id}').serviceProvider.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="8a-ServeObservations">
      <name value="8a-ServeObservations"/>
      <description value="Test Server query operation for Observations"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Test XIS server to serve Observation resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-8a-ServeObservations"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <!-- pregnancy duration -->
      <!-- parity -->
      <!-- gravidity -->
      <!-- woonsituatie -->
      <!-- beoordeling familiesituatie -->
      <!-- participatie in maatschappij -->
      <!-- zorg voor kind -->
      <!-- gewenste plaats bevalling -->
      <!-- gewenste wijze voeden -->
      <!-- tijdstip breken vliezen -->
      <!-- vruchtwater -->
      <!-- tijdstip actief meepersen -->
      <!-- type partus -->
      <!-- bloedverlies -->
      <!-- ligging kind (bij geboorte) -->
      <!-- compleetheid placenta -->
      <!-- aantal bloedvaten -->
      <!-- tijd geboorte placenta -->
      <!-- Apgar Score 1-minuut -->
      <!-- Apgar Score 5-minuten -->
      <!-- Apgar Score 10-minuten -->
      <!-- Geboortegewicht -->
      <!-- Lichaamsgewicht -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 3 Observation resource(s) with code http://loinc.org | 29463-7. (Lichaamsgewicht)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '29463-7').count()=3).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Lichaamstemperatuur -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 2 Observation resource(s) with code http://loinc.org | 8310-5. (Lichaamstemperatuur)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://loinc.org' and code = '8310-5').count()=2).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Voedingpatroon kind -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 2 Observation resource(s) with code http://snomed.info/sct | 289145007. (Voedingpatroon kind)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '289145007').count()=2).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Slaapgedrag -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 404950004. (Slaapgedrag)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '404950004').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Huilgedrag -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 28263002. (Huilgedrag)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '28263002').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Navelstreng -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364595007. (Navelstreng)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364595007').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Bevindingen huid -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 364528001. (Bevindingen huid)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '364528001').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Voorlichting veilig slapen -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 1263932002. (Voorlichting veilig slapen)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '1263932002').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Voorlichting vitamine D -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 118791000146100. (Voorlichting vitamine D)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '118791000146100').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Vitamine K toegediend -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 698350008. (Vitamine K toegediend)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '698350008').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Datum gehoortest -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 252957005. (Datum gehoortest)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '252957005').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Datum hielprik -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Observation resource(s) with code http://snomed.info/sct | 77262006. (Datum hielprik)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Observation)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '77262006').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 1"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a4907bc6-2392-11ec-8669-030000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '57036006'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '57036006'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-PregnancyDuration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-PregnancyDuration')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/workflow-supportingInfoSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/workflow-supportingInfoSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '57036006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '57036006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-9"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-10"/>
            <description value="Contains .valueQuantity with .value '281' and .system 'http://unitsofmeasure.org' and .code 'd'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907bc6-2392-11ec-8669-030000000000-id}').value.ofType(Quantity).where(value = 281 and system = 'http://unitsofmeasure.org' and code = 'd').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 2"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 0d47afc6-2063-11ec-1749-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11977-6'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11977-6'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-Parity'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-Parity')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '11977-6' and .display and .coding with .system 'http://snomed.info/sct' and .code '364325004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').code.where(coding.where(system = 'http://loinc.org' and code = '11977-6' and display) and coding.where(system = 'http://snomed.info/sct' and code = '364325004' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-8"/>
            <description value="Contains .valueQuantity with .value '1'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afc6-2063-11ec-1749-020000000000-id}').value.ofType(Quantity).value = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 3"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 0d47gec7-2063-11ec-1751-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11996-6'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '11996-6'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-Gravidity'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-Gravidity')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '11996-6' and .display and .coding with .system 'http://snomed.info/sct' and .code '161732006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').code.where(coding.where(system = 'http://loinc.org' and code = '11996-6' and display) and coding.where(system = 'http://snomed.info/sct' and code = '161732006' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-8"/>
            <description value="Contains .valueQuantity with .value '1'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47gec7-2063-11ec-1751-020000000000-id}').value.ofType(Quantity).value = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 4"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 2-17-831-1-113883-2-4-6-108004321)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365508006'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365508006'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-LivingSituation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-LivingSituation').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '365508006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '365508006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-6"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.13.1' and .code 'EENGEZW' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').value.ofType(CodeableConcept).coding.where(system = 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.13.1' and code = 'EENGEZW' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="4-7"/>
            <description value="Contains .comment with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-6-108004321-id}').comment.hasValue()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 5"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 193477a5-3fde-11ec-3274-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365470003'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365470003'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-FamilySituationAssessment'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-FamilySituationAssessment').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '365470003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '365470003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="5-6"/>
            <description value="Contains .comment with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193477a5-3fde-11ec-3274-020000000000-id}').comment.hasValue()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 6"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 1c6e08c1-9edr-11ec-1563-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '314845004'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '314845004'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-ParticipationInSociety'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-ParticipationInSociety').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '314845004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '314845004' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-7"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '364703007' and .display, and .valueString with a value. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364703007' and display) and value.ofType(string).hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-7-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '364703007' and .display. This assert checks only one child. Assert 6-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364703007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="6-7-2"/>
            <description value="Contains .component.valueString with a value. This assert checks only one child. Assert 6-7 checks if all children are present in the same parent. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${1c6e08c1-9edr-11ec-1563-020000000000-id}').component.where(value.ofType(string).hasValue()).exists()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 7"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7816n34-2191-19ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '129879003'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '129879003'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-AbilityToTakeCareOfChild'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-AbilityToTakeCareOfChild').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '129879003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '129879003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-6"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '160351000146107' and .display, and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '159921000146103' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '160351000146107' and display) and value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '159921000146103' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-6-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '160351000146107' and .display. This assert checks only one child. Assert 7-6 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '160351000146107' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-6-2"/>
            <description value="Contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '159921000146103' and .display. This assert checks only one child. Assert 7-6 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '159921000146103' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-7"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '160341000146109' and .display, and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '126291000146104' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '160341000146109' and display) and value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '126291000146104' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-7-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '160341000146109' and .display. This assert checks only one child. Assert 7-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '160341000146109' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="7-7-2"/>
            <description value="Contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '126291000146104' and .display. This assert checks only one child. Assert 7-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7816n34-2191-19ec-8669-020000000000-id}').component.where(value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '126291000146104' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 8"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 2-17-831-1-113773-2-4-5-107004321)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '142961000146102'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '142961000146102'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '142961000146102' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '142961000146102' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="8-6"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '264362003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113773-2-4-5-107004321-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '264362003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 9"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 2-17-831-1-113883-2-4-5-107004321)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '169740003'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '169740003'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '169740003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '169740003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="9-6"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '169643005' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${2-17-831-1-113883-2-4-5-107004321-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '169643005' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 10"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d238d44b-2062-11ec-2089-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '289251005'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '289251005'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '289251005' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '289251005' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="10-8"/>
            <description value="Contains .valueDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2089-020000000000-id}').value.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 11"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d238d44b-2062-11ec-2046-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '366334007'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '366334007'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '366334007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '366334007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="11-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '168090003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d44b-2062-11ec-2046-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '168090003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 12"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d735d974-2062-11ed-2093-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249163006'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249163006'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '249163006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '249163006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="12-8"/>
            <description value="Contains .valueDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d974-2062-11ed-2093-020000000000-id}').value.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 13"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d715d984-2062-11ed-2093-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364336006'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364336006'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '364336006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '364336006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="13-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '61586001' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-11ed-2093-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '61586001' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 14"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 166579o5-8fde-12ec-3274-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364332008'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364332008'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '364332008' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '364332008' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="14-8"/>
            <description value="Contains .valueQuantity with .value '400' and .unit and .system 'http://unitsofmeasure.org' and .code 'ml'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166579o5-8fde-12ec-3274-020000000000-id}').value.ofType(Quantity).where(value = 400 and unit and system = 'http://unitsofmeasure.org' and code = 'ml').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 15"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d715d984-2062-68es-2093-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '271692001'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '271692001'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-BirthObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '271692001' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '271692001' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="15-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '37235006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d984-2062-68es-2093-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '37235006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 16"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a239d44b-2062-11ec-2089-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364343000'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364343000'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '364343000' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '364343000' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="16-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '268479002' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d44b-2062-11ec-2089-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '268479002' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 17"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a239d24h-2062-11ec-2089-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249191003'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '249191003'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '249191003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '249191003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="17-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '29691000146104' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a239d24h-2062-11ec-2089-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '29691000146104' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 18"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d238d34c-2062-11ec-2089-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '136311000146100'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '136311000146100'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-2"/>
            <description value="Contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3' with .valueReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').extension('http://nictiz.nl/fhir/StructureDefinition/observation-focusSTU3').value.ofType(Reference).where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-3"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-4"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '136311000146100' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '136311000146100' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="18-8"/>
            <description value="Contains .valueDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d238d34c-2062-11ec-2089-020000000000-id}').value.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 19"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a4907b9r-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9272-6'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9272-6'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-4"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '9272-6' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '9272-6' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-7"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-8"/>
            <description value="Contains .valueQuantity with .value '7'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').value.ofType(Quantity).value = 7"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="19-9"/>
            <description value="Contains .comment with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b9r-2291-11ec-8669-020000000000-id}').comment.hasValue()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 20"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a4912b60-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9274-2'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9274-2'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-4"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '9274-2' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '9274-2' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-7"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="20-8"/>
            <description value="Contains .valueQuantity with .value '10'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4912b60-2291-11ec-8669-020000000000-id}').value.ofType(Quantity).value = 10"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 21"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a4907b81-2290-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9271-8'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '9271-8'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-ApgarScore')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-4"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '9271-8' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '9271-8' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-7"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="21-8"/>
            <description value="Contains .valueQuantity with .value '10'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4907b81-2290-11ec-8669-020000000000-id}').value.ofType(Quantity).value = 10"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 22"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a4506b72-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8339-4'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8339-4'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '29463-7' and .display and .coding with .system 'http://loinc.org' and .code '8339-4' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').code.where(coding.where(system = 'http://loinc.org' and code = '29463-7' and display) and coding.where(system = 'http://loinc.org' and code = '8339-4' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-8"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-9"/>
            <description value="Contains .valueQuantity with .value '3600' and .unit and .system 'http://unitsofmeasure.org' and .code 'g'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').value.ofType(Quantity).where(value = 3600 and unit and system = 'http://unitsofmeasure.org' and code = 'g').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-10"/>
            <description value="Contains .component with .code with .coding with .system 'http://loinc.org' and .code '8352-7' and .display, and .valueCodeableConcept with .coding with .system 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.8.1' and .code 'UNDRESSED' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://loinc.org' and code = '8352-7' and display) and value.ofType(CodeableConcept).coding.where(system = 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.8.1' and code = 'UNDRESSED' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-10-1"/>
            <description value="Contains .component.code with .coding with .system 'http://loinc.org' and .code '8352-7' and .display. This assert checks only one child. Assert 22-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://loinc.org' and code = '8352-7' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="22-10-2"/>
            <description value="Contains .component.valueCodeableConcept with .coding with .system 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.8.1' and .code 'UNDRESSED' and .display. This assert checks only one child. Assert 22-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a4506b72-2291-11ec-8669-020000000000-id}').component.where(value.ofType(CodeableConcept).coding.where(system = 'urn:oid:2.16.840.1.113883.2.4.3.11.60.40.4.8.1' and code = 'UNDRESSED' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 23"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d735d999-2062-11ec-1087-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3400').count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3400').id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '29463-7' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '29463-7' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-8"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="23-9"/>
            <description value="Contains .valueQuantity with .value '3400' and .unit and .system 'http://unitsofmeasure.org' and .code 'g'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d735d999-2062-11ec-1087-020000000000-id}').value.ofType(Quantity).where(value = 3400 and unit and system = 'http://unitsofmeasure.org' and code = 'g').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 24"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: d715d939-2012-11ec-1087-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3630').count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '29463-7')) and value.ofType(Quantity).value = '3630').id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyWeight')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '29463-7' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '29463-7' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-8"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="24-9"/>
            <description value="Contains .valueQuantity with .value '3630' and .unit and .system 'http://unitsofmeasure.org' and .code 'g'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${d715d939-2012-11ec-1087-020000000000-id}').value.ofType(Quantity).where(value = 3630 and unit and system = 'http://unitsofmeasure.org' and code = 'g').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 25"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 166578a5-8fde-12ec-3274-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.7').count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.7').id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyTemperature'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyTemperature').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '8310-5' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '8310-5' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-8"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="25-9"/>
            <description value="Contains .valueQuantity with .value '36.7' and .unit and .system 'http://unitsofmeasure.org' and .code 'Cel'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${166578a5-8fde-12ec-3274-020000000000-id}').value.ofType(Quantity).where(value = 36.7 and unit and system = 'http://unitsofmeasure.org' and code = 'Cel').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 26"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 193578a5-8fde-12ec-3274-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.8').count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '8310-5')) and value.ofType(Quantity).value = '36.8').id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyTemperature'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-BodyTemperature').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-5"/>
            <description value="Contains .code with .coding with .system 'http://loinc.org' and .code '8310-5' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').code.coding.where(system = 'http://loinc.org' and code = '8310-5' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-8"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="26-9"/>
            <description value="Contains .valueQuantity with .value '36.8' and .unit and .system 'http://unitsofmeasure.org' and .code 'Cel'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193578a5-8fde-12ec-3274-020000000000-id}').value.ofType(Quantity).where(value = 36.8 and unit and system = 'http://unitsofmeasure.org' and code = 'Cel').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 27"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a2406b64-2391-14ec-4667-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &lt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &lt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-FeedingPatternInfant'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-FeedingPatternInfant').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '289145007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '289145007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-6"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-7"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '364653007' and .display, and .valueQuantity with .value '8' and .unit and .system 'http://unitsofmeasure.org' and .code 'd'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364653007' and display) and value.ofType(Quantity).where(value = 8 and unit and system = 'http://unitsofmeasure.org' and code = 'd')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-7-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '364653007' and .display. This assert checks only one child. Assert 27-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364653007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-7-2"/>
            <description value="Contains .component.valueQuantity with .value '8' and .unit and .system 'http://unitsofmeasure.org' and .code 'd'. This assert checks only one child. Assert 27-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(value.ofType(Quantity).where(value = 8 and unit and system = 'http://unitsofmeasure.org' and code = 'd').exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-8"/>
            <description value="Contains .component with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '169741004' and .display and .code with .coding with .system 'http://snomed.info/sct' and .code '109021000146107' and .display, and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '226789007' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '169741004' and display) and code.coding.where(system = 'http://snomed.info/sct' and code = '109021000146107' and display) and value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '226789007' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-8-1"/>
            <description value="Contains .component.extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '169741004' and .display. This assert checks only one child. Assert 27-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '169741004' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-8-2"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '109021000146107' and .display. This assert checks only one child. Assert 27-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '109021000146107' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="27-8-3"/>
            <description value="Contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '226789007' and .display. This assert checks only one child. Assert 27-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-4667-020000000000-id}').component.where(value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '226789007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 28"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: a2406b64-2391-14ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &gt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="iif(Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0].effective.toDateTime() &gt; Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1].effective.toDateTime(), Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[0], Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code='289145007')))[1]).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-FeedingPatternInfant'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').meta.profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-FeedingPatternInfant').exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '289145007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '289145007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-6"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-7"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '364653007' and .display, and .valueQuantity with .value '8' and .unit and .system 'http://unitsofmeasure.org' and .code 'd'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364653007' and display) and value.ofType(Quantity).where(value = 8 and unit and system = 'http://unitsofmeasure.org' and code = 'd')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-7-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '364653007' and .display. This assert checks only one child. Assert 28-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '364653007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-7-2"/>
            <description value="Contains .component.valueQuantity with .value '8' and .unit and .system 'http://unitsofmeasure.org' and .code 'd'. This assert checks only one child. Assert 28-7 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(value.ofType(Quantity).where(value = 8 and unit and system = 'http://unitsofmeasure.org' and code = 'd').exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-8"/>
            <description value="Contains .component with .extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '169741004' and .display and .code with .coding with .system 'http://snomed.info/sct' and .code '109021000146107' and .display, and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '226789007' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '169741004' and display) and code.coding.where(system = 'http://snomed.info/sct' and code = '109021000146107' and display) and value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '226789007' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-8-1"/>
            <description value="Contains .component.extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod' with .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '169741004' and .display. This assert checks only one child. Assert 28-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(extension('http://nictiz.nl/fhir/StructureDefinition/zib-FeedingPatternInfant-FeedingMethod').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '169741004' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-8-2"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '109021000146107' and .display. This assert checks only one child. Assert 28-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '109021000146107' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="28-8-3"/>
            <description value="Contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '226789007' and .display. This assert checks only one child. Assert 28-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${a2406b64-2391-14ec-8669-020000000000-id}').component.where(value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '226789007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 29"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: v6516b72-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '404950004'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '404950004'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '404950004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '404950004' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="29-7"/>
            <description value="Contains .valueString with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${v6516b72-2291-11ec-8669-020000000000-id}').value.ofType(string).hasValue()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 30"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: g3506b72-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '28263002'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '28263002'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '28263002' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '28263002' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="30-7"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://hl7.org/fhir/v3/NullFlavor' and .code 'OTH' and .display and .text with a value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${g3506b72-2291-11ec-8669-020000000000-id}').value.ofType(CodeableConcept).where(coding.where(system = 'http://hl7.org/fhir/v3/NullFlavor' and code = 'OTH' and display) and text.hasValue()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 31"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 8224fe9f-43b4-4917-aac5-5d69269560b4)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364595007'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364595007'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '364595007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '364595007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-7"/>
            <description value="Contains .effectiveDateTime"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').effective.ofType(dateTime).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="31-8"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '772131003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${8224fe9f-43b4-4917-aac5-5d69269560b4-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '772131003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 32"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7806b72-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364528001'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '364528001'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '364528001' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '364528001' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="32-7"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '281900007' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b72-2291-11ec-8669-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '281900007' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 33"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7806b34-2391-11rz-8263-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '1263932002'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '1263932002'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '1263932002' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '1263932002' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="33-6"/>
            <description value="Contains .valueString with a value. This assert only checks existence of a value, because string comparisons can have many possible caveats"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2391-11rz-8263-020000000000-id}').value.ofType(string).hasValue()"/>
            <warningOnly value="true"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 34"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7106b24-2291-11ex-8663-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '118791000146100'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '118791000146100'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-MaternalObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-2"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-3"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '118791000146100' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '118791000146100' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-4"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-5"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="34-6"/>
            <description value="Contains .valueBoolean 'true'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7106b24-2291-11ex-8663-020000000000-id}').value.ofType(boolean) = true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 35"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 193478a5-8fde-12ec-3274-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '698350008'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '698350008'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-VitaminKAdministration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-VitaminKAdministration')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-4"/>
            <description value="Contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '698350008' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '698350008' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-8"/>
            <description value="Contains .valueBoolean 'true'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').value.ofType(boolean) = true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-9"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '439771001' and .display, and .valueDateTime. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439771001' and display) and value.ofType(dateTime)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-9-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '439771001' and .display. This assert checks only one child. Assert 35-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439771001' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="35-9-2"/>
            <description value="Contains .component.valueDateTime. This assert checks only one child. Assert 35-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${193478a5-8fde-12ec-3274-020000000000-id}').component.where(value.ofType(dateTime).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 36"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7806b34-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '252957005'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '252957005'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '252957005' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '252957005' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-7"/>
            <description value="Contains .valueBoolean 'true'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').value.ofType(boolean) = true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-8"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '439272007' and .display, and .valueDateTime. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439272007' and display) and value.ofType(dateTime)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-8-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '439272007' and .display. This assert checks only one child. Assert 36-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439272007' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="36-8-2"/>
            <description value="Contains .component.valueDateTime. This assert checks only one child. Assert 36-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7806b34-2291-11ec-8669-020000000000-id}').component.where(value.ofType(dateTime).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8a-ServeObservations - Check Observation 37"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: b7859b34-2291-11ec-8669-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '77262006'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '77262006'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ChildObservation')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '77262006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '77262006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-7"/>
            <description value="Contains .valueBoolean 'true'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').value.ofType(boolean) = true"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-8"/>
            <description value="Contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '439771001' and .display, and .valueDateTime. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439771001' and display) and value.ofType(dateTime)).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-8-1"/>
            <description value="Contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '439771001' and .display. This assert checks only one child. Assert 37-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').component.where(code.coding.where(system = 'http://snomed.info/sct' and code = '439771001' and display).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="37-8-2"/>
            <description value="Contains .component.valueDateTime. This assert checks only one child. Assert 37-8 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${b7859b34-2291-11ec-8669-020000000000-id}').component.where(value.ofType(dateTime).exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="8b-ServeObservations">
      <name value="8b-ServeObservations"/>
      <description value="Test Server query operation for Observations"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Test XIS server to serve Observation resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context:Encounter.episodeofcare=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-8b-ServeObservations"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 2 Observation resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Observation)).count() = 2"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- alcoholgebruik -->
      <!-- tabakgebruik -->
   </test>
   <test>
      <name value="8b-ServeObservations - Check Observation 1"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 0d47afe5-2063-11ec-1752-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '228273003'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '228273003'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-AlcoholUse'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-AlcoholUse')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '228273003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '228273003' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '105542008' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe5-2063-11ec-1752-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '105542008' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="8b-ServeObservations - Check Observation 2"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: 0d47afe9-2063-11ec-1752-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Observation"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365980008'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(code.where(coding.where(code = '365980008'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-1"/>
            <description value="Contains .meta with .profile 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation' and .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-TobaccoUse'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').meta.where(profile.where($this = 'http://fhir.nl/fhir/StructureDefinition/nl-core-observation') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-TobaccoUse')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-3"/>
            <description value="Contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').status = 'final'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-4"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '365980008' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '365980008' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-5"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-6"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-7"/>
            <description value="Contains .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '405746006' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${0d47afe9-2063-11ec-1752-020000000000-id}').value.ofType(CodeableConcept).coding.where(system = 'http://snomed.info/sct' and code = '405746006' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="9-ServeProcedures">
      <name value="9-ServeProcedures"/>
      <description value="Test Server query operation for (Obstetric) Procedures"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Procedure"/>
            <description value="Test XIS server to serve Procedure resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}&amp;_include=Procedure:performer&amp;_include=Procedure:based-on"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-9-ServeProcedures"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 3 Procedure resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Procedure)).count() = 3"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 0 Organization resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(Organization)).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 0 ProcedureRequest resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(ProcedureRequest)).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Verrichting (Bevalling) -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Procedure resource(s) with code http://snomed.info/sct | 236973005. (Bevalling)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Procedure)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '236973005').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Verrichting (Geboorte) -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Procedure resource(s) with code http://snomed.info/sct | 3950001. (Geboorte)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Procedure)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '3950001').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <!-- Verrichting (Hechting) -->
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned searchset Bundle contains 1 Procedure resource(s) with code http://snomed.info/sct | 29701000146104. (Hechting)"/>
            <direction value="response"/>
            <expression value="Bundle.where(entry.where(resource.is(Procedure)).resource.code.coding.where(system = 'http://snomed.info/sct' and code = '29701000146104').count()=1).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="9-ServeProcedures - Check Procedure 1"/>
      <description value="Check if the previous operation results in a FHIR Procedure that contains the values that are expected following Nictiz' materials (fixture .id: d135d241-2062-11ec-2089-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Procedure"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '236973005'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Procedure resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '236973005'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryProcedure'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-DeliveryProcedure')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-3"/>
            <description value="Contains .status 'completed'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').status = 'completed'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-4"/>
            <description value="Contains .category with .coding with .system 'http://snomed.info/sct' and .code '386637004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').category.coding.where(system = 'http://snomed.info/sct' and code = '386637004' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '236973005' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '236973005' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="1-8"/>
            <description value="Contains .reasonReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${d135d241-2062-11ec-2089-020000000000-id}').reasonReference.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="9-ServeProcedures - Check Procedure 2"/>
      <description value="Check if the previous operation results in a FHIR Procedure that contains the values that are expected following Nictiz' materials (fixture .id: 6b971017-a6d9-11ek-1598-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Procedure"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '3950001'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Procedure resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '3950001'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-Birth'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-Birth')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-3"/>
            <description value="Contains .partOf with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').partOf.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-4"/>
            <description value="Contains .status 'completed'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').status = 'completed'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-5"/>
            <description value="Contains .category with .coding with .system 'http://snomed.info/sct' and .code '386637004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').category.coding.where(system = 'http://snomed.info/sct' and code = '386637004' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-6"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '3950001' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '3950001' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-7"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-8"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="2-9"/>
            <description value="Contains .reasonReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${6b971017-a6d9-11ek-1598-020000000000-id}').reasonReference.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="9-ServeProcedures - Check Procedure 3"/>
      <description value="Check if the previous operation results in a FHIR Procedure that contains the values that are expected following Nictiz' materials (fixture .id: 66aa1132-2064-11ec-5265-020000000000)"/>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Response Bundle contains exactly 1 Procedure"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '29701000146104'))).count() = 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Procedure resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(code.where(coding.where(code = '29701000146104'))).id.exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-1"/>
            <description value="Contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure' and .profile 'http://nictiz.nl/fhir/StructureDefinition/bc-ObstetricProcedure'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Procedure') and profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/bc-ObstetricProcedure')).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-2"/>
            <description value="Contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').identifier.where(system and value).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-3"/>
            <description value="Contains .status 'completed'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').status = 'completed'"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-4"/>
            <description value="Contains .category with .coding with .system 'http://snomed.info/sct' and .code '386637004' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').category.coding.where(system = 'http://snomed.info/sct' and code = '386637004' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-5"/>
            <description value="Contains .code with .coding with .system 'http://snomed.info/sct' and .code '29701000146104' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').code.coding.where(system = 'http://snomed.info/sct' and code = '29701000146104' and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-6"/>
            <description value="Contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').subject.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-7"/>
            <description value="Contains .context with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').context.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <label value="3-8"/>
            <description value="Contains .reasonReference with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Procedure).where(id = '${66aa1132-2064-11ec-5265-020000000000-id}').reasonReference.where((reference or identifier) and display).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test id="10-ServeCareTeam">
      <name value="10-ServeCareTeam"/>
      <description value="Test Server query operation for CareTeam"/>
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="CareTeam"/>
            <description value="Test XIS server to serve CareTeam resources."/>
            <accept value="xml"/>
            <destination value="1"/>
            <encodeRequestUrl value="true"/>
            <origin value="1"/>
            <params value="?context=EpisodeOfCare/${episode-id}"/>
            <requestHeader>
               <field value="Authorization"/>
               <value value="${patient-token-id}"/>
            </requestHeader>
            <requestHeader>
               <field value="MedMij-Request-ID"/>
               <value value="${UUID}"/>
            </requestHeader>
            <requestHeader>
               <field value="X-Correlation-ID"/>
               <value value="${X-Correlation-ID}"/>
            </requestHeader>
            <responseId value="fixture-10-ServeCareTeam"/>
         </operation>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="true"/>
            </extension>
            <description value="Confirm that the operation was successful"/>
            <operator value="in"/>
            <responseCode value="200,201"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned resource type is Bundle."/>
            <direction value="response"/>
            <resource value="Bundle"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle type is searchset."/>
            <direction value="response"/>
            <expression value="Bundle.type"/>
            <operator value="equals"/>
            <value value="searchset"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources contain an Resource.id except when temporary ids are used in the Bundle. The only time that a resource does not have an id is when it is being submitted to the server using a create operation: https://www.hl7.org/fhir/STU3/resource-definitions.html#Resource.id "/>
            <direction value="response"/>
            <expression value="Bundle.entry.all( $this.fullUrl.matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or $this.fullUrl.matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') or $this.resource.id.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all returned resources except OperationOutcome and Binary contain a meta.profile tag."/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.where(is(OperationOutcome).not()).where(is(Binary).not()).where(meta.profile.empty()).empty()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl does not disagree with the id in the resource, see http://hl7.org/fhir/stu3/bundle-definitions.html#Bundle.entry.fullUrl"/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(fullUrl.exists() and resource.id.exists()).all($this.fullUrl.endsWith($this.resource.id))"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the fullUrl is an absolute URL, an uuid or an oid."/>
            <direction value="response"/>
            <expression value="Bundle.entry.fullUrl.all( startsWith('http://') or startsWith('https://') or matches('^urn:oid:[0-2](\\.(0|[1-9]\\d*))*$') or matches('^urn:uuid:[A-Fa-f\\d]{8}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{4}-[A-Fa-f\\d]{12}$') )"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle conforms to the base FHIR specification and the resources to the stated profiles in the meta.profile tag."/>
            <direction value="response"/>
            <validateProfileId value="Bundle-profile"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Coding elements contain both a .system and a .code."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Coding)).all(system.exists() and code.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the OID of the zib valueset is not used for the system of a coding element."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(coding)).system.startsWith('urn:oid:2.16.840.1.113883.2.4.3.11.60.40.2').not()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all CodeableConcept elements contain either a coding.display or a text value if no Coding exists or has an extension (e.g. a nullFlavor or data-absent-reason extension). For more information see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3Use_of_coded_concepts."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(CodeableConcept)) .all(coding.display.exists() or text.exists() or extension.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all References have a display value, see https://informatiestandaarden.nictiz.nl/wiki/FHIR:V1.0_FHIR_IG_STU3#Use_of_the_reference_datatype."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Reference)).all(display.exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/data-absent-reason').exists() or extension.where(url = 'http://hl7.org/fhir/StructureDefinition/iso21090-nullFlavor').exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that all Identifiers have both a .system and a .value. In rare cases where a general category of identifiers can be used, .type can replace .system. Edge cases for both .system and .type to be unknown are not applicable to Nictiz. For more information, see https://www.hl7.org/fhir/stu3/datatypes.html#Identifier."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().where($this.is(Identifier)).all((system.exists() or type.exists()) and value.exists())"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) anywhere."/>
            <direction value="response"/>
            <expression value="Bundle.descendants().select(identifier.where(system = 'http://fhir.nl/fhir/NamingSystem/bsn').where(value.empty().not() and value.extension.exists().not())).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the Bundle.total."/>
            <direction value="response"/>
            <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the returned Bundle contains a self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.where(relation = 'self' and url.exists()).exists()"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that Bundle does not use Burgerservicenummer (BSN) in the self link."/>
            <direction value="response"/>
            <expression value="Bundle.link.url.contains('http://fhir.nl/fhir/NamingSystem/bsn') = false"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-rule">
               <extension url="ruleId">
                  <valueId value="assert-response-queryParamsInSelfLink"/>
               </extension>
            </extension>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <extension url="http://touchstone.aegis.net/touchstone/fhir/testing/StructureDefinition/testscript-assert-stopTestOnFail">
               <valueBoolean value="false"/>
            </extension>
            <description value="Confirm that the response Bundle contains 0 CareTeam resource(s). "/>
            <direction value="response"/>
            <expression value="Bundle.entry.where(resource.is(CareTeam)).count() = 0"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>
