<?xml version="1.0" encoding="UTF-8"?>
<!-- TODO deze test moet voor xis in tweeen gesplitst worden en voor deel 2 2e lijn nog content asserts toevoegen -->
<TestScript xmlns="http://hl7.org/fhir"
            xmlns:nts="http://nictiz.nl/xsl/testscript"
            nts:scenario="server">
   <id value="gbz-fhir3-0-2-ikz-xis-1-4"/>
   <version value="stu3-3.0"/>
   <name value="Nictiz Geboortezorg - Server - Scenario 1.4 - Serve Integrale Zwangerschapskaart primary and secondary care resources of multiple pregnancy of Jamila Kwee"/>
   <description value="Scenario 1.4: Serve Integrale Zwangerschapskaart primary care resources of multiple pregnancy of Jamila Kwee"/>
   <nts:authToken patientResourceId="JAMILAJXXX-KWEE"/>
   <variable>
      <name value="dossier1-id"/>
      <defaultValue value="66aa2fcb-2064-11ec-5265-020000000000"/>
   </variable>
   <variable>
      <name value="dossier2-id"/>
      <defaultValue value="a490614b-2291-11ec-8669-020000000000"/>
   </variable>
   <variable>
      <name value="T"/>
      <defaultValue value="${CURRENTDATE}"/>
   </variable>
   
   <!-- Patient - Zwangere vrouw -->
   <test id="1-ServeWoman">
      <name value="1-ServeWoman"/>
      <description value="Query Patient resource for HCIM Patient"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Patient"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.numResources" scope="common">
         <nts:with-parameter name="resource" value="Patient"/>
         <nts:with-parameter name="count" value="1"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-nl-core-patient-JAMILAJXXX-KWEE.xml"
                          nts:in-targets="CheckContent"/>
   </test>
   
   <!-- EpisodeOfCare - Actieve zwangerschap (dossier) -->
   <test id="2-ServeMaternalRecord">
      <name value="2-ServeMaternalRecord"/>
      <description value="Test Server query operation for MaternalRecord (EpisodeOfCare) including managing organization (Organization) and care manager (Practitioner)"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="EpisodeOfCare"/>
         <nts:with-parameter name="params"
                             value="?type=http://snomed.info/sct|364320009&amp;status=active&amp;_include=EpisodeOfCare:organization&amp;_include=EpisodeOfCare:care-manager"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="EpisodeOfCare"
                   count="2"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Organization"
                   count="2"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Practitioner"
                   count="2"/>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-MaternalRecord-66aa2fcb-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent"/>
   </test>
   
   <!-- Conditions - Problemen gerelateerd aan dossier incl. zwangerschap -->
   <test id="3-ServeConditions">
      <name value="3-ServeConditions"/>
      <description value="Test Server query operation for Conditions (including Pregnancy)"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Condition"/>
         <nts:with-parameter name="params"
                             value="?context=EpisodeOfCare/${dossier1-id},EpisodeOfCare/${dossier2-id}"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Condition"
                   count="6"/>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Zwangerschap)"/>
         <nts:with-parameter name="resource" value="Condition"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="118185001"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Meerlingzwangerschap)"/>
         <nts:with-parameter name="resource" value="Condition"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="16356006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Groeiafwijking)"/>
         <nts:with-parameter name="resource" value="Condition"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="22033007"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Liggingsafwijking)"/>
         <nts:with-parameter name="resource" value="Condition"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="15028002"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-Pregnancy118185001-66aa440b-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code=118185001)</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-DisorderOfPregnancy16356006-66aa442e-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code=16356006)</nts:discriminator>
      </nts:contentAsserts>
   </test>
   
   <!-- Encounters - Prenatale controles/contacten gekoppeld aan dossier -->
   <test id="4-ServePrenatalVisits">
      <name value="4-ServePrenatalVisits"/>
      <description value="Test Server query operation for PrenatalVisits (Encounter)"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Encounter"/>
         <nts:with-parameter name="params"
                             value="?episodeofcare=${dossier1-id},${dossier2-id}&amp;_include=Encounter:practitioner"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Encounter"
                   count="3"/>
      <nts:include value="assert.response.numResourcesWithCode" scope="common">
         <nts:with-parameter name="additionalDescription" value="(ContactSoort)"/>
         <nts:with-parameter name="codedElement" value="type"/>
         <nts:with-parameter name="resource" value="Encounter"/>
         <nts:with-parameter name="count" value="3"/>
         <nts:with-parameter name="code" value="11429006"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-Encounter-66aa441d-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent"/>
   </test>
   
   <!-- Observations - Observaties gekoppeld aan dossier -->
   <test id="5a-ServeObservations">
      <name value="5a-ServeObservations"/>
      <description value="Test Server query operation for Observations"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="params"
                             value="?context=EpisodeOfCare/${dossier1-id},EpisodeOfCare/${dossier2-id}"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(parity)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="11977-6"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(gravidity)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="11996-6"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(term date)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="161714006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(date last menstruation)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="21840007"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(def term date)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="147781000146105"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(multiple pregnancy)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="65147003"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(number of living offspring)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="143881000146107"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(fetal loss)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="0"/>
         <nts:with-parameter name="code" value="713651007"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(folium accid intake)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="792807003"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(pregnancy duration)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="57036006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(onset first stage of labor)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="0"/>
         <nts:with-parameter name="code" value="439771001"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(type first stage of labor)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="0"/>
         <nts:with-parameter name="code" value="249120008"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(parturition type)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="364336006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(number of offspring)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="118861000146102"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(place of birth)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="169812000"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(blood pressure)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="85354-9"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Hb)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="4"/>
         <nts:with-parameter name="code" value="93846-4"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Rhesus D)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="1305-2"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Rhesus C)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="1159-3"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Bloedgroep)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="883-9"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Toxoplasma)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="8039-0"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Apgar Score 1-minuut)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="9272-6"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Apgar Score 5-minuten)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="9274-2"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Apgar Score 10-minuten)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="9271-8"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Geboortegewicht)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="8339-4"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Geboortelengte)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="89269-5"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Hoofdomtrek)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="169876006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-PregnancyObservation161714006-66aa440f-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='161714006')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-PregnancyObservation65147003-46aa440f-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='65147003')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-MaternalObservation792807003-66aa441c-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='792807003')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-LaboratoryTestResult-Observation93846-4-66aa3b32-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='93846-4')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-LaboratoryTestResult-Observation1305-2-66aa37ae-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='1305-2')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-LaboratoryTestResult-Observation1159-3-66aa3970-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='1159-3')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-LaboratoryTestResult-Observation883-9-66aa35ec-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='883-9')</nts:discriminator>
      </nts:contentAsserts>
   </test>
   
   <!-- Observations - Observaties gekoppeld aan prenatale controle -->
   <test id="5b-ServeObservations">
      <name value="5b-ServeObservations"/>
      <description value="Test Server query operation for Observations"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="params"
                             value="?context:Encounter.episodeofcare=EpisodeOfCare/${dossier1-id},EpisodeOfCare/${dossier2-id}"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Observation"
                   count="15"/>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(pregnancy duration)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="3"/>
         <nts:with-parameter name="code" value="57036006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(fetal movement)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="364618000"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(body weight)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="29463-7"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(blood pressure)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="3"/>
         <nts:with-parameter name="code" value="85354-9"/>
         <nts:with-parameter name="system" value="http://loinc.org"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(alcohol use)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="228273003"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(drug use)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="228366006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(tobacco use)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="365980008"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(fetal heart rate)"/>
         <nts:with-parameter name="resource" value="Observation"/>
         <nts:with-parameter name="count" value="0"/>
         <nts:with-parameter name="code" value="249043002"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-BodyWeight29463-7-66aa4965-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='29463-7')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-AlcoholUse228273003-66aa4425-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='228273003')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-DrugUse228366006-66aa4427-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='228366006')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-zib-TobaccoUse365980008-66aa442a-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='365980008')</nts:discriminator>
      </nts:contentAsserts>
   </test>
   
   <!-- Procedures - Verrichtingen gekoppeld aan dossier -->
   <!--To include child Patient use: &amp;_include=Procedure:subject-->
   <test id="6-ServeProcedures">
      <name value="6-ServeProcedures"/>
      <description value="Test Server query operation for Procedures including performing Organization and underlying ProcedureRequest"/>
      <nts:include value="gbz-operation-search-xis">
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="params"
                             value="?context=EpisodeOfCare/${dossier1-id},EpisodeOfCare/${dossier2-id}&amp;_include=Procedure:performer&amp;_include=Procedure:based-on"/>
      </nts:include>
      <nts:include value="assert.request.authorizationHeader" scope="common"/>
      <nts:include value="medmij/assert.response.successfulSearch"
                   scope="common"
                   resource="Bundle"/>
      <nts:include value="assert.response.queryParamsInSelfLink" scope="common"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Organization"
                   count="1"/>
      <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="ProcedureRequest"
                   count="0"/>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Diet control)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="410175003"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Blood exam)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="396550006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Delivery)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="236973005"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="()"/>
         <nts:with-parameter name="resource" value="Organization"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="element" value="type"/>
         <nts:with-parameter name="code" value="V5"/>
         <nts:with-parameter name="system"
                             value="http://nictiz.nl/fhir/NamingSystem/organization-type"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Opname in ziekenhuis)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="32485007"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Primaire sectio caesarea)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="80771000146107"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Vitamine K toediening neonaat)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="2"/>
         <nts:with-parameter name="code" value="698350008:370131001=133933007"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:include value="gbz-assert-returnCountWithCode">
         <nts:with-parameter name="additionalDescription" value="(Inflatie long)"/>
         <nts:with-parameter name="resource" value="Procedure"/>
         <nts:with-parameter name="count" value="1"/>
         <nts:with-parameter name="code" value="243140006"/>
         <nts:with-parameter name="system" value="http://snomed.info/sct"/>
      </nts:include>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-ObstetricProcedure410175003-66aa4435-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='410175003')</nts:discriminator>
      </nts:contentAsserts>
      <nts:contentAsserts href="Vrouw2-Kaart3-1elijn/medmij-gbz-bc-ObstetricProcedure396550006-66aa4432-2064-11ec-5265-020000000000.xml"
                          nts:in-targets="CheckContent">
         <nts:discriminator>code.where(coding.code='396550006')</nts:discriminator>
      </nts:contentAsserts>
   </test>
</TestScript>
