<?xml version="1.0" encoding="UTF-8"?>
<!--
     @param patient - The Patient id that should be included in the resource
     @param questionnaire - The Questionnaire id that should be included in the resource
-->
<nts:component xmlns="http://hl7.org/fhir" xmlns:nts="http://nictiz.nl/xsl/testscript">
    <action>
        <assert>
            <description value="Confirm that the Task contains .intent with value 'order'"/>
            <direction value="request"/>
            <expression value="Task.intent = 'order'"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the Task contains .code with .coding with .system = 'http://loinc.org' and .code = '74468-0'"/>
            <direction value="request"/>
            <expression value="Task.code.coding.where(system = 'http://loinc.org' and code = '74468-0').exists()"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the Task contains .requester.agent with references to the Practitioner and PractitionerRole from the orginal Task"/>
            <direction value="request"/>
            <expression value="Task.requester.agent.where(reference = 'Practitioner/000001111FRANSLIJSTER' and extension('http://nictiz.nl/fhir/StructureDefinition/practitionerrole-reference').value.where($this is Reference).reference = 'PractitionerRole/medmij-questionnaires-nl-core-practitionerrole-01').exists()"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the Task contains .owner with a reference to the Patient from the orginal Task"/>
            <direction value="request"/>
            <expression value="Task.owner.reference = 'Patient/{$patient}'"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the Task contains .input with .type.text = 'Questionnaire' and a reference to the Questionnaire from the original Task"/>
            <direction value="request"/>
            <expression value="Task.input.where(type.text = 'Questionnaire' and value.where($this is Reference).reference ='{$questionnaire}').exists()"/>
        </assert>
    </action>
    <action>
        <assert>
            <description value="Confirm that the Task contains .input with .type.text = 'Subject' and a reference to the Patient from the original Task"/>
            <direction value="request"/>
            <expression value="Task.input.where(type.text = 'Subject' and value.where($this is Reference).reference ='Patient/{$patient}').exists()"/>
        </assert>
    </action>
</nts:component>
