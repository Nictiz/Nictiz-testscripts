<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="http://hl7.org/fhir/STU3/testscript.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<TestScript xmlns="http://hl7.org/fhir"
            xmlns:nts="http://nictiz.nl/xsl/testscript"
            nts:scenario="server">
   <id value="xis-1-1-serve-respiration"/>
   <version value="stu3-2.0"/>
   <name value="SelfMeasurements - XIS Server - Test Scenario 1.X - Serve respiration Observation resources"/>
   <description value="Scenario 1.X - Serve all respiration Observation resources"/>
   <nts:authToken patientResourceId="selfmeasurements-Patient-XXX-Smorenburg"/>
   <nts:includeDateT value="yes"/>
   <test id="scenario1-1-serve-all-respiration">
        <name value="Scenario 1.1"/>
        <description value="Serve all respiration Observation resources"/>
        <nts:include value="medmij/test.xis.successfulSearch"
                   scope="common"
                   resource="Observation"
                   params="?code=http://snomed.info/sct|422834003"
                   responseId="fixture-scenario1-1-serve-all-respiration"/>
        <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Observation"
                   count="5"/>
        
        
        
        
        
        
    </test>
   <test>
      <name value="Scenario 1.1 - Check Observation 1"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: selfmeasurements-Respiration1)"/>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Response Bundle contains exactly 1 Observation resource with a component (code = '9279-1')  that contains valueQuantity.value = '15'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=15))).count() = 1"/>
         </assert>
      </action>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=15))).id.exists()"/>
         </assert>
      </action>
      <variable>
         <name value="selfmeasurements-Respiration1-id"/>
         <description value="Resource.id for Observation 1"/>
         <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=15))).id"/>
         <sourceId value="fixture-scenario1-1-serve-all-respiration"/>
      </variable>
      <action>
         <assert>
            <label value="1-1"/>
            <description value="Observation 1 contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration').exists()).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-2"/>
            <description value="Observation 1 contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').identifier.where(system and value).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-3"/>
            <description value="Observation 1 contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').status = 'final'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-4"/>
            <description value="Observation 1 contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-5"/>
            <description value="Observation 1 contains .code with .coding with .system 'http://snomed.info/sct' and .code '422834003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').code.where(coding.where(system = 'http://snomed.info/sct' and code = '422834003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-6"/>
            <description value="Observation 1 contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').subject.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-7"/>
            <description value="Observation 1 contains .effectiveDateTime "/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').effective.ofType(dateTime).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-7-checkDateTime"/>
            <description value="Observation 1 contains .effectiveDateTime with a value that equals T-date - 3 days"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').effective.ofType(dateTime) ~ @${T} - 3 days"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-8"/>
            <description value="Observation 1 contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').performer.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-9"/>
            <description value="Observation 1 contains .component with .code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display and .valueQuantity with .value '15' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.where(code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)) and value.ofType(Quantity).where(value = 15 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-9-1"/>
            <description value="Observation 1 contains .component.code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-9-2"/>
            <description value="Observation 1 contains .component.valueQuantity with .value '15' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks only one child. Assert 1-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.value.ofType(Quantity).where(value = 15 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$')).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-10"/>
            <description value="Observation 1 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-10-1"/>
            <description value="Observation 1 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display. This assert checks only one child. Assert 1-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-10-2"/>
            <description value="Observation 1 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks only one child. Assert 1-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-11"/>
            <description value="Observation 1 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-11-1"/>
            <description value="Observation 1 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display. This assert checks only one child. Assert 1-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="1-11-2"/>
            <description value="Observation 1 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks only one child. Assert 1-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration1-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display)).exists()"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 1.1 - Check Observation 2"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: selfmeasurements-Respiration2)"/>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Response Bundle contains exactly 1 Observation resource with a component (code = '9279-1')  that contains valueQuantity.value = '22'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=22))).count() = 1"/>
         </assert>
      </action>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=22))).id.exists()"/>
         </assert>
      </action>
      <variable>
         <name value="selfmeasurements-Respiration2-id"/>
         <description value="Resource.id for Observation 2"/>
         <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=22))).id"/>
         <sourceId value="fixture-scenario1-1-serve-all-respiration"/>
      </variable>
      <action>
         <assert>
            <label value="2-1"/>
            <description value="Observation 2 contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration').exists()).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-2"/>
            <description value="Observation 2 contains .extension with url 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen' with .extension with url 'extraOxygenAdministration' with .valueBoolean 'true' and .extension with url 'fiO2' with .valueQuantity with .value '0.3' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').extension('http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen').where(extension('extraOxygenAdministration').where(value.ofType(Boolean) = true) and extension('fiO2').where(value.ofType(Quantity).where(value = 0.3 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}$')))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-2-1"/>
            <description value="Observation 2 contains .extension('http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen').extension with url 'extraOxygenAdministration' with .valueBoolean 'true'. This assert checks only one child. Assert 2-2 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').extension('http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen').extension('extraOxygenAdministration').where(value.ofType(Boolean) = true).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-2-2"/>
            <description value="Observation 2 contains .extension('http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen').extension with url 'fiO2' with .valueQuantity with .value '0.3' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}$'. This assert checks only one child. Assert 2-2 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').extension('http://nictiz.nl/fhir/StructureDefinition/zib-Respiration-AdministeredOxygen').extension('fiO2').where(value.ofType(Quantity).where(value = 0.3 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-3"/>
            <description value="Observation 2 contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').identifier.where(system and value).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-4"/>
            <description value="Observation 2 contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').status = 'final'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-5"/>
            <description value="Observation 2 contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-6"/>
            <description value="Observation 2 contains .code with .coding with .system 'http://snomed.info/sct' and .code '422834003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').code.where(coding.where(system = 'http://snomed.info/sct' and code = '422834003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-7"/>
            <description value="Observation 2 contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').subject.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-8"/>
            <description value="Observation 2 contains .effectiveDateTime "/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').effective.ofType(dateTime).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-8-checkDateTime"/>
            <description value="Observation 2 contains .effectiveDateTime with a value that equals T-date - 5 days"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').effective.ofType(dateTime) ~ @${T} - 5 days"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-9"/>
            <description value="Observation 2 contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').performer.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-10"/>
            <description value="Observation 2 contains .comment 'na het traplopen'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').comment.replace('.', '').replace(',', '') ~ 'na het traplopen'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-11"/>
            <description value="Observation 2 contains .component with .code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display and .valueQuantity with .value '22' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.where(code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)) and value.ofType(Quantity).where(value = 22 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-11-1"/>
            <description value="Observation 2 contains .component.code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display. This assert checks only one child. Assert 2-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-11-2"/>
            <description value="Observation 2 contains .component.valueQuantity with .value '22' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks only one child. Assert 2-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.value.ofType(Quantity).where(value = 22 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$')).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-12"/>
            <description value="Observation 2 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-12-1"/>
            <description value="Observation 2 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display. This assert checks only one child. Assert 2-12 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-12-2"/>
            <description value="Observation 2 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks only one child. Assert 2-12 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-13"/>
            <description value="Observation 2 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '386616007' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '386616007' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-13-1"/>
            <description value="Observation 2 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display. This assert checks only one child. Assert 2-13 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="2-13-2"/>
            <description value="Observation 2 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '386616007' and .display. This assert checks only one child. Assert 2-13 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration2-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '386616007' and display)).exists()"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 1.1 - Check Observation 3"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: selfmeasurements-Respiration3)"/>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Response Bundle contains exactly 1 Observation resource with a component (code = '9279-1')  that contains valueQuantity.value = '14'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=14))).count() = 1"/>
         </assert>
      </action>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=14))).id.exists()"/>
         </assert>
      </action>
      <variable>
         <name value="selfmeasurements-Respiration3-id"/>
         <description value="Resource.id for Observation 3"/>
         <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=14))).id"/>
         <sourceId value="fixture-scenario1-1-serve-all-respiration"/>
      </variable>
      <action>
         <assert>
            <label value="3-1"/>
            <description value="Observation 3 contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration').exists()).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-2"/>
            <description value="Observation 3 contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').identifier.where(system and value).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-3"/>
            <description value="Observation 3 contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').status = 'final'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-4"/>
            <description value="Observation 3 contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-5"/>
            <description value="Observation 3 contains .code with .coding with .system 'http://snomed.info/sct' and .code '422834003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').code.where(coding.where(system = 'http://snomed.info/sct' and code = '422834003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-6"/>
            <description value="Observation 3 contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').subject.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-7"/>
            <description value="Observation 3 contains .effectiveDateTime "/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').effective.ofType(dateTime).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-7-checkDateTime"/>
            <description value="Observation 3 contains .effectiveDateTime with a value that equals T-date - 14 days"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').effective.ofType(dateTime) ~ @${T} - 14 days"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-8"/>
            <description value="Observation 3 contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').performer.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-9"/>
            <description value="Observation 3 contains .component with .code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display and .valueQuantity with .value '14' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.where(code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)) and value.ofType(Quantity).where(value = 14 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-9-1"/>
            <description value="Observation 3 contains .component.code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display. This assert checks only one child. Assert 3-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-9-2"/>
            <description value="Observation 3 contains .component.valueQuantity with .value '14' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks only one child. Assert 3-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.value.ofType(Quantity).where(value = 14 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$')).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-10"/>
            <description value="Observation 3 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-10-1"/>
            <description value="Observation 3 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display. This assert checks only one child. Assert 3-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-10-2"/>
            <description value="Observation 3 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks only one child. Assert 3-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-11"/>
            <description value="Observation 3 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-11-1"/>
            <description value="Observation 3 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display. This assert checks only one child. Assert 3-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="3-11-2"/>
            <description value="Observation 3 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks only one child. Assert 3-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration3-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display)).exists()"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 1.1 - Check Observation 4"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: selfmeasurements-Respiration4)"/>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Response Bundle contains exactly 1 Observation resource with a component (code = '9279-1')  that contains valueQuantity.value = '16'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=16))).count() = 1"/>
         </assert>
      </action>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=16))).id.exists()"/>
         </assert>
      </action>
      <variable>
         <name value="selfmeasurements-Respiration4-id"/>
         <description value="Resource.id for Observation 4"/>
         <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=16))).id"/>
         <sourceId value="fixture-scenario1-1-serve-all-respiration"/>
      </variable>
      <action>
         <assert>
            <label value="4-1"/>
            <description value="Observation 4 contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration').exists()).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-2"/>
            <description value="Observation 4 contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').identifier.where(system and value).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-3"/>
            <description value="Observation 4 contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').status = 'final'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-4"/>
            <description value="Observation 4 contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-5"/>
            <description value="Observation 4 contains .code with .coding with .system 'http://snomed.info/sct' and .code '422834003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').code.where(coding.where(system = 'http://snomed.info/sct' and code = '422834003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-6"/>
            <description value="Observation 4 contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').subject.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-7"/>
            <description value="Observation 4 contains .effectiveDateTime "/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').effective.ofType(dateTime).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-7-checkDateTime"/>
            <description value="Observation 4 contains .effectiveDateTime with a value that equals T-date - 340 days"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').effective.ofType(dateTime) ~ @${T} - 340 days"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-8"/>
            <description value="Observation 4 contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').performer.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-9"/>
            <description value="Observation 4 contains .component with .code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display and .valueQuantity with .value '16' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.where(code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)) and value.ofType(Quantity).where(value = 16 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-9-1"/>
            <description value="Observation 4 contains .component.code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display. This assert checks only one child. Assert 4-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-9-2"/>
            <description value="Observation 4 contains .component.valueQuantity with .value '16' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks only one child. Assert 4-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.value.ofType(Quantity).where(value = 16 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$')).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-10"/>
            <description value="Observation 4 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-10-1"/>
            <description value="Observation 4 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display. This assert checks only one child. Assert 4-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-10-2"/>
            <description value="Observation 4 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks only one child. Assert 4-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-11"/>
            <description value="Observation 4 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-11-1"/>
            <description value="Observation 4 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display. This assert checks only one child. Assert 4-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="4-11-2"/>
            <description value="Observation 4 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks only one child. Assert 4-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration4-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display)).exists()"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Scenario 1.1 - Check Observation 5"/>
      <description value="Check if the previous operation results in a FHIR Observation that contains the values that are expected following Nictiz' materials (fixture .id: selfmeasurements-Respiration5)"/>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Response Bundle contains exactly 1 Observation resource with a component (code = '9279-1')  that contains valueQuantity.value = '13'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=13))).count() = 1"/>
         </assert>
      </action>
      <action>
         <assert nts:stopTestOnFail="true">
            <description value="Observation resource evaluated in the previous assert contains an .id"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=13))).id.exists()"/>
         </assert>
      </action>
      <variable>
         <name value="selfmeasurements-Respiration5-id"/>
         <description value="Resource.id for Observation 5"/>
         <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.where(coding.where(code = '9279-1')) and value.ofType(Quantity).where(value=13))).id"/>
         <sourceId value="fixture-scenario1-1-serve-all-respiration"/>
      </variable>
      <action>
         <assert>
            <label value="5-1"/>
            <description value="Observation 5 contains .meta with .profile 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').meta.where(profile.where($this = 'http://nictiz.nl/fhir/StructureDefinition/zib-Respiration').exists()).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-2"/>
            <description value="Observation 5 contains .identifier with .system and .value"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').identifier.where(system and value).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-3"/>
            <description value="Observation 5 contains .status 'final'"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').status = 'final'"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-4"/>
            <description value="Observation 5 contains .category with .coding with .system 'http://hl7.org/fhir/observation-category' and .code 'vital-signs' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').category.where(coding.where(system = 'http://hl7.org/fhir/observation-category' and code = 'vital-signs' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-5"/>
            <description value="Observation 5 contains .code with .coding with .system 'http://snomed.info/sct' and .code '422834003' and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').code.where(coding.where(system = 'http://snomed.info/sct' and code = '422834003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-6"/>
            <description value="Observation 5 contains .subject with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').subject.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-7"/>
            <description value="Observation 5 contains .effectiveDateTime "/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').effective.ofType(dateTime).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-7-checkDateTime"/>
            <description value="Observation 5 contains .effectiveDateTime with a value that equals T-date - 723 days"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').effective.ofType(dateTime) ~ @${T} - 723 days"/>
            <warningOnly value="true"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-8"/>
            <description value="Observation 5 contains .performer with either .reference or .identifier and .display"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').performer.where((reference or identifier) and display).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-9"/>
            <description value="Observation 5 contains .component with .code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display and .valueQuantity with .value '13' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.where(code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)) and value.ofType(Quantity).where(value = 13 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$'))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-9-1"/>
            <description value="Observation 5 contains .component.code with .coding with .system 'http://loinc.org' and .code '9279-1' and .display. This assert checks only one child. Assert 5-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.code.where(coding.where(system = 'http://loinc.org' and code = '9279-1' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-9-2"/>
            <description value="Observation 5 contains .component.valueQuantity with .value '13' and .unit and .system 'http://unitsofmeasure.org' and .code matching regex '^\\{.+\\}/min$'. This assert checks only one child. Assert 5-9 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.value.ofType(Quantity).where(value = 13 and unit and system = 'http://unitsofmeasure.org' and code.matches('^\\{.+\\}/min$')).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-10"/>
            <description value="Observation 5 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-10-1"/>
            <description value="Observation 5 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '48064009' and .display. This assert checks only one child. Assert 5-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '48064009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-10-2"/>
            <description value="Observation 5 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '5467003' and .display. This assert checks only one child. Assert 5-10 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '5467003' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-11"/>
            <description value="Observation 5 contains .component with .code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display and .valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks if all children exist (if applicable with their specific values) and if they are present within one element. Following asserts check if individual children exist to help you debug if this assert fails"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.where(code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)) and value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display))).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-11-1"/>
            <description value="Observation 5 contains .component.code with .coding with .system 'http://snomed.info/sct' and .code '271626009' and .display. This assert checks only one child. Assert 5-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.code.where(coding.where(system = 'http://snomed.info/sct' and code = '271626009' and display)).exists()"/>
         </assert>
      </action>
      <action>
         <assert>
            <label value="5-11-2"/>
            <description value="Observation 5 contains .component.valueCodeableConcept with .coding with .system 'http://snomed.info/sct' and .code '301284009' and .display. This assert checks only one child. Assert 5-11 checks if all children are present in the same parent"/>
            <direction value="response"/>
            <expression value="Bundle.entry.resource.ofType(Observation).where(id = '${selfmeasurements-Respiration5-id}').component.value.ofType(CodeableConcept).where(coding.where(system = 'http://snomed.info/sct' and code = '301284009' and display)).exists()"/>
         </assert>
      </action>
   </test>
   <test id="scenario1-2-serve-all-respiration">
        <name value="Scenario 1.2"/>
        <description value="Serve latest respiration Observation resources"/>
        <nts:include value="medmij/test.xis.successfulSearch"
                   scope="common"
                   resource="Observation"
                   params="/$lastn?code=http://snomed.info/sct|422834003"/>
        <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Observation"
                   count="1"/>

        <action>
            <assert>
                <description value="Confirm that the correct Observation is returned"/>
                <direction value="response"/>
                <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.coding.code='9279-1').value.ofType(Quantity).where(value=15)).exists()"/>
            </assert>
        </action>
    </test>
   <test id="scenario1-3-serve-all-respirations">
        <name value="Scenario 1.3"/>
        <description value="Serve period respiration Observation resources"/>
        <nts:include value="medmij/test.xis.successfulSearch"
                   scope="common"
                   resource="Observation"
                   params="?code=http://snomed.info/sct|422834003&amp;date=ge${DATE, T, D,-14}&amp;date=le${DATE, T, D,-5}"/>
        <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Observation"
                   count="2"/>

        <action>
            <assert>
                <description value="Confirm that the correct Observation is returned"/>
                <direction value="response"/>
                <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.coding.code='9279-1').value.ofType(Quantity).where(value=22)).exists()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the correct Observation is returned"/>
                <direction value="response"/>
                <expression value="Bundle.entry.resource.ofType(Observation).where(component.where(code.coding.code='9279-1').value.ofType(Quantity).where(value=14)).exists()"/>
            </assert>
        </action>
    </test>
   <test id="scenario1-4-serve-all-respirations">
        <name value="Scenario 1.4"/>
        <description value="Serve period respiration Observation resources"/>
        <nts:include value="medmij/test.xis.successfulSearch"
                   scope="common"
                   resource="Observation"
                   params="?code=http://snomed.info/sct|422834003&amp;date=ge${DATE, T, D,-12}&amp;date=le${DATE, T, D,-6}"/>
        <nts:include value="assert.response.numResources"
                   scope="common"
                   resource="Observation"
                   count="0"/>
    </test>
</TestScript>
